<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>zeroinstall.injector.policy</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="zeroinstall-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://0install.net">Project Homepage</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="zeroinstall-module.html">Package&nbsp;zeroinstall</a> ::
        <a href="zeroinstall.injector-module.html">Package&nbsp;injector</a> ::
        Module&nbsp;policy
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="zeroinstall.injector.policy-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="zeroinstall.injector.policy-module.html">Module zeroinstall.injector.policy</a></h1>
<pre class="py-src">
<span class="py-lineno">  1</span>  <span class="py-line"><span class="py-docstring">"""</span> </span>
<span class="py-lineno">  2</span>  <span class="py-line"><span class="py-docstring">Chooses a set of implementations based on a policy.</span> </span>
<span class="py-lineno">  3</span>  <span class="py-line"><span class="py-docstring">"""</span> </span>
<span class="py-lineno">  4</span>  <span class="py-line"> </span>
<span class="py-lineno">  5</span>  <span class="py-line"><span class="py-comment"># Copyright (C) 2007, Thomas Leonard</span> </span>
<span class="py-lineno">  6</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># See the README file for details, or visit http://0install.net.</span> </span>
<span class="py-lineno">  7</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno">  8</span>  <span class="py-line"><span class="py-keyword">import</span> <span class="py-name">time</span> </span>
<span class="py-lineno">  9</span>  <span class="py-line"><span class="py-keyword">import</span> <span class="py-name">sys</span><span class="py-op">,</span> <span class="py-name">os</span><span class="py-op">,</span> <span class="py-name">sets</span> </span>
<span class="py-lineno"> 10</span>  <span class="py-line"><span class="py-keyword">from</span> <span class="py-name">logging</span> <span class="py-keyword">import</span> <span class="py-name">info</span><span class="py-op">,</span> <span class="py-name">debug</span><span class="py-op">,</span> <span class="py-name">warn</span> </span>
<span class="py-lineno"> 11</span>  <span class="py-line"><span class="py-keyword">import</span> <span id="link-0" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-0', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span> </span>
<span class="py-lineno"> 12</span>  <span class="py-line"> </span>
<span class="py-lineno"> 13</span>  <span class="py-line"><span class="py-keyword">from</span> <span id="link-1" class="py-name"><a title="zeroinstall.injector.model" class="py-name" href="#" onclick="doclink('link-1', 'model', 'Module zeroinstall.injector.model=zeroinstall.injector.model-module.html'); return false;">model</a></span></span> <span class="py-keyword">import</span> <span class="py-op">*</span> </span>
<span class="py-lineno"> 14</span>  <span class="py-line"><span class="py-keyword">import</span> <span id="link-2" class="py-name"><a title="zeroinstall.injector.basedir" class="py-name" href="#" onclick="doclink('link-2', 'basedir', 'Module zeroinstall.injector.basedir=zeroinstall.injector.basedir-module.html'); return false;">basedir</a></span></span> </span>
<span class="py-lineno"> 15</span>  <span class="py-line"><span class="py-keyword">from</span> <span id="link-3" class="py-name"><a title="zeroinstall.injector.namespaces" class="py-name" href="#" onclick="doclink('link-3', 'namespaces', 'Module zeroinstall.injector.namespaces=zeroinstall.injector.namespaces-module.html'); return false;">namespaces</a></span></span> <span class="py-keyword">import</span> <span class="py-op">*</span> </span>
<span class="py-lineno"> 16</span>  <span class="py-line"><span class="py-keyword">import</span> <span class="py-name">ConfigParser</span> </span>
<span class="py-lineno"> 17</span>  <span class="py-line"><span class="py-keyword">import</span> <span id="link-4" class="py-name"><a title="zeroinstall.injector.reader" class="py-name" href="#" onclick="doclink('link-4', 'reader', 'Module zeroinstall.injector.reader=zeroinstall.injector.reader-module.html'); return false;">reader</a></span></span> </span>
<span class="py-lineno"> 18</span>  <span class="py-line"><span class="py-keyword">from</span> <span id="link-5" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-5', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span> <span class="py-keyword">import</span> <span id="link-6" class="py-name"><a title="zeroinstall.NeedDownload" class="py-name" href="#" onclick="doclink('link-6', 'NeedDownload', 'Class zeroinstall.NeedDownload=zeroinstall.NeedDownload-class.html'); return false;">NeedDownload</a></span></span> </span>
<span class="py-lineno"> 19</span>  <span class="py-line"><span class="py-keyword">from</span> <span id="link-7" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-7', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span><span class="py-op">.</span><span id="link-8" class="py-name"><a title="zeroinstall.injector" class="py-name" href="#" onclick="doclink('link-8', 'injector', 'Package zeroinstall.injector=zeroinstall.injector-module.html'); return false;">injector</a></span></span><span class="py-op">.</span><span id="link-9" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-9', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span> <span class="py-keyword">import</span> <span id="link-10" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-10', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">,</span> <span id="link-11" class="py-name"><a title="zeroinstall.injector.iface_cache.PendingFeed" class="py-name" href="#" onclick="doclink('link-11', 'PendingFeed', 'Class zeroinstall.injector.iface_cache.PendingFeed=zeroinstall.injector.iface_cache.PendingFeed-class.html'); return false;">PendingFeed</a></span></span> </span>
<span class="py-lineno"> 20</span>  <span class="py-line"><span class="py-keyword">from</span> <span id="link-12" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-12', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span><span class="py-op">.</span><span id="link-13" class="py-name"><a title="zeroinstall.injector" class="py-name" href="#" onclick="doclink('link-13', 'injector', 'Package zeroinstall.injector=zeroinstall.injector-module.html'); return false;">injector</a></span></span><span class="py-op">.</span><span id="link-14" class="py-name"><a title="zeroinstall.injector.trust" class="py-name" href="#" onclick="doclink('link-14', 'trust', 'Module zeroinstall.injector.trust=zeroinstall.injector.trust-module.html'); return false;">trust</a></span></span> <span class="py-keyword">import</span> <span id="link-15" class="py-name"><a title="zeroinstall.injector.trust.trust_db" class="py-name" href="#" onclick="doclink('link-15', 'trust_db', 'Variable zeroinstall.injector.trust.trust_db=zeroinstall.injector.trust-module.html#trust_db'); return false;">trust_db</a></span></span> </span>
<span class="py-lineno"> 21</span>  <span class="py-line"> </span>
<a name="_Cook"></a><div id="_Cook-def"><span class="py-lineno"> 22</span> <a class="py-toggle" href="#" id="_Cook-toggle" onclick="toggle('_Cook'); return false;">-</a><span class="py-line"><span class="py-keyword">class</span> <a class="py-def-name" href="zeroinstall.injector.policy._Cook-class.html">_Cook</a><span class="py-op">:</span> </span>
</div><div id="_Cook-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="_Cook-expanded"><span class="py-lineno"> 23</span>  <span class="py-line">        <span class="py-docstring">"""A Cook follows a Recipe."""</span> </span>
<span class="py-lineno"> 24</span>  <span class="py-line">        <span class="py-comment"># Maybe we're taking this metaphor too far?</span> </span>
<span class="py-lineno"> 25</span>  <span class="py-line"><span class="py-comment"></span> </span>
<a name="_Cook.__init__"></a><div id="_Cook.__init__-def"><span class="py-lineno"> 26</span> <a class="py-toggle" href="#" id="_Cook.__init__-toggle" onclick="toggle('_Cook.__init__'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy._Cook-class.html#__init__">__init__</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">policy</span><span class="py-op">,</span> <span class="py-param">required_digest</span><span class="py-op">,</span> <span class="py-param">recipe</span><span class="py-op">,</span> <span class="py-param">force</span> <span class="py-op">=</span> <span class="py-name">False</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="_Cook.__init__-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="_Cook.__init__-expanded"><span class="py-lineno"> 27</span>  <span class="py-line">                <span class="py-docstring">"""Start downloading all the ingredients."""</span> </span>
<span class="py-lineno"> 28</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">recipe</span> <span class="py-op">=</span> <span class="py-name">recipe</span> </span>
<span class="py-lineno"> 29</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">required_digest</span> <span class="py-op">=</span> <span class="py-name">required_digest</span> </span>
<span class="py-lineno"> 30</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">downloads</span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-op">}</span>     <span class="py-comment"># Downloads that are not yet successful</span> </span>
<span class="py-lineno"> 31</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">streams</span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-op">}</span>       <span class="py-comment"># Streams collected from successful downloads</span> </span>
<span class="py-lineno"> 32</span>  <span class="py-line"> </span>
<span class="py-lineno"> 33</span>  <span class="py-line">                <span class="py-comment"># Start a download for each ingredient</span> </span>
<span class="py-lineno"> 34</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">for</span> <span class="py-name">step</span> <span class="py-keyword">in</span> <span class="py-name">recipe</span><span class="py-op">.</span><span class="py-name">steps</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 35</span>  <span class="py-line">                        <span class="py-name">dl</span> <span class="py-op">=</span> <span id="link-16" class="py-name"><a title="zeroinstall.injector.policy" class="py-name" href="#" onclick="doclink('link-16', 'policy', 'Module zeroinstall.injector.policy=zeroinstall.injector.policy-module.html'); return false;">policy</a></span></span><span class="py-op">.</span><span id="link-17" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.begin_archive_download
zeroinstall.injector.policy.Policy.begin_archive_download" class="py-name" href="#" onclick="doclink('link-17', 'begin_archive_download', 'Method zeroinstall.injector.autopolicy.AutoPolicy.begin_archive_download()=zeroinstall.injector.autopolicy.AutoPolicy-class.html#begin_archive_download,Method zeroinstall.injector.policy.Policy.begin_archive_download()=zeroinstall.injector.policy.Policy-class.html#begin_archive_download'); return false;">begin_archive_download</a></span></span><span class="py-op">(</span><span class="py-name">step</span><span class="py-op">,</span> <span class="py-name">success_callback</span> <span class="py-op">=</span>  </span>
<span class="py-lineno"> 36</span>  <span class="py-line">                                <span class="py-keyword">lambda</span> <span class="py-name">stream</span><span class="py-op">,</span> <span class="py-name">step</span><span class="py-op">=</span><span class="py-name">step</span><span class="py-op">:</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">ingredient_ready</span><span class="py-op">(</span><span class="py-name">step</span><span class="py-op">,</span> <span class="py-name">stream</span><span class="py-op">)</span><span class="py-op">,</span> </span>
<span class="py-lineno"> 37</span>  <span class="py-line">                                <span class="py-name">force</span> <span class="py-op">=</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 38</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">downloads</span><span class="py-op">[</span><span class="py-name">step</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">dl</span> </span>
<span class="py-lineno"> 39</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">test_done</span><span class="py-op">(</span><span class="py-op">)</span>        <span class="py-comment"># Needed for empty recipes</span> </span>
</div><span class="py-lineno"> 40</span>  <span class="py-line"> </span>
<span class="py-lineno"> 41</span>  <span class="py-line">                <span class="py-comment"># Note: the only references to us are held by the on_success callback</span> </span>
<span class="py-lineno"> 42</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># in each Download. On error this is removed, which will cause us</span> </span>
<span class="py-lineno"> 43</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># to be destoryed, which will release all the temporary files we hold.</span> </span>
<span class="py-lineno"> 44</span>  <span class="py-line"><span class="py-comment"></span>         </span>
<a name="_Cook.ingredient_ready"></a><div id="_Cook.ingredient_ready-def"><span class="py-lineno"> 45</span> <a class="py-toggle" href="#" id="_Cook.ingredient_ready-toggle" onclick="toggle('_Cook.ingredient_ready'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy._Cook-class.html#ingredient_ready">ingredient_ready</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">step</span><span class="py-op">,</span> <span class="py-param">stream</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="_Cook.ingredient_ready-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="_Cook.ingredient_ready-expanded"><span class="py-lineno"> 46</span>  <span class="py-line">                <span class="py-comment"># Called when one archive has been fetched. Store it until the other</span> </span>
<span class="py-lineno"> 47</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># archives arrive.</span> </span>
<span class="py-lineno"> 48</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">assert</span> <span class="py-name">step</span> <span class="py-keyword">not</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">streams</span> </span>
<span class="py-lineno"> 49</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">streams</span><span class="py-op">[</span><span class="py-name">step</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">stream</span> </span>
<span class="py-lineno"> 50</span>  <span class="py-line">                <span class="py-keyword">del</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">downloads</span><span class="py-op">[</span><span class="py-name">step</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 51</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">test_done</span><span class="py-op">(</span><span class="py-op">)</span> </span>
</div><span class="py-lineno"> 52</span>  <span class="py-line">         </span>
<a name="_Cook.test_done"></a><div id="_Cook.test_done-def"><span class="py-lineno"> 53</span> <a class="py-toggle" href="#" id="_Cook.test_done-toggle" onclick="toggle('_Cook.test_done'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy._Cook-class.html#test_done">test_done</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="_Cook.test_done-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="_Cook.test_done-expanded"><span class="py-lineno"> 54</span>  <span class="py-line">                <span class="py-comment"># On success, a download is removed from here. If empty, it means that</span> </span>
<span class="py-lineno"> 55</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># all archives have successfully been downloaded.</span> </span>
<span class="py-lineno"> 56</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">downloads</span><span class="py-op">:</span> <span class="py-keyword">return</span> </span>
<span class="py-lineno"> 57</span>  <span class="py-line"> </span>
<span class="py-lineno"> 58</span>  <span class="py-line">                <span class="py-keyword">from</span> <span id="link-18" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-18', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span><span class="py-op">.</span><span id="link-19" class="py-name"><a title="zeroinstall.zerostore" class="py-name" href="#" onclick="doclink('link-19', 'zerostore', 'Package zeroinstall.zerostore=zeroinstall.zerostore-module.html'); return false;">zerostore</a></span></span> <span class="py-keyword">import</span> <span id="link-20" class="py-name"><a title="zeroinstall.zerostore.unpack" class="py-name" href="#" onclick="doclink('link-20', 'unpack', 'Module zeroinstall.zerostore.unpack=zeroinstall.zerostore.unpack-module.html'); return false;">unpack</a></span></span> </span>
<span class="py-lineno"> 59</span>  <span class="py-line"> </span>
<span class="py-lineno"> 60</span>  <span class="py-line">                <span class="py-comment"># Create an empty directory for the new implementation</span> </span>
<span class="py-lineno"> 61</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">store</span> <span class="py-op">=</span> <span id="link-21" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-21', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-22" class="py-name"><a title="zeroinstall.zerostore.cli.stores" class="py-name" href="#" onclick="doclink('link-22', 'stores', 'Variable zeroinstall.zerostore.cli.stores=zeroinstall.zerostore.cli-module.html#stores'); return false;">stores</a></span></span><span class="py-op">.</span><span id="link-23" class="py-name"><a title="zeroinstall.zerostore.cli.stores" class="py-name" href="#" onclick="doclink('link-23', 'stores', 'Variable zeroinstall.zerostore.cli.stores=zeroinstall.zerostore.cli-module.html#stores'); return false;">stores</a></span></span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 62</span>  <span class="py-line">                <span class="py-name">tmpdir</span> <span class="py-op">=</span> <span class="py-name">store</span><span class="py-op">.</span><span id="link-24" class="py-name"><a title="zeroinstall.zerostore.Store.get_tmp_dir_for" class="py-name" href="#" onclick="doclink('link-24', 'get_tmp_dir_for', 'Method zeroinstall.zerostore.Store.get_tmp_dir_for()=zeroinstall.zerostore.Store-class.html#get_tmp_dir_for'); return false;">get_tmp_dir_for</a></span></span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">required_digest</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 63</span>  <span class="py-line">                <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 64</span>  <span class="py-line">                        <span class="py-comment"># Unpack each of the downloaded archives into it in turn</span> </span>
<span class="py-lineno"> 65</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-keyword">for</span> <span class="py-name">step</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">recipe</span><span class="py-op">.</span><span class="py-name">steps</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 66</span>  <span class="py-line">                                <span id="link-25" class="py-name"><a title="zeroinstall.zerostore.unpack" class="py-name" href="#" onclick="doclink('link-25', 'unpack', 'Module zeroinstall.zerostore.unpack=zeroinstall.zerostore.unpack-module.html'); return false;">unpack</a></span></span><span class="py-op">.</span><span id="link-26" class="py-name"><a title="zeroinstall.zerostore.unpack.unpack_archive" class="py-name" href="#" onclick="doclink('link-26', 'unpack_archive', 'Function zeroinstall.zerostore.unpack.unpack_archive()=zeroinstall.zerostore.unpack-module.html#unpack_archive'); return false;">unpack_archive</a></span></span><span class="py-op">(</span><span class="py-name">step</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">streams</span><span class="py-op">[</span><span class="py-name">step</span><span class="py-op">]</span><span class="py-op">,</span> <span class="py-name">tmpdir</span><span class="py-op">,</span> <span class="py-name">step</span><span class="py-op">.</span><span class="py-name">extract</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 67</span>  <span class="py-line">                        <span class="py-comment"># Check that the result is correct and store it in the cache</span> </span>
<span class="py-lineno"> 68</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-name">store</span><span class="py-op">.</span><span id="link-27" class="py-name"><a title="zeroinstall.zerostore.Store.check_manifest_and_rename" class="py-name" href="#" onclick="doclink('link-27', 'check_manifest_and_rename', 'Method zeroinstall.zerostore.Store.check_manifest_and_rename()=zeroinstall.zerostore.Store-class.html#check_manifest_and_rename'); return false;">check_manifest_and_rename</a></span></span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">required_digest</span><span class="py-op">,</span> <span class="py-name">tmpdir</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 69</span>  <span class="py-line">                        <span class="py-name">tmpdir</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno"> 70</span>  <span class="py-line">                <span class="py-keyword">finally</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 71</span>  <span class="py-line">                        <span class="py-comment"># If unpacking fails, remove the temporary directory</span> </span>
<span class="py-lineno"> 72</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-keyword">if</span> <span class="py-name">tmpdir</span> <span class="py-keyword">is</span> <span class="py-keyword">not</span> <span class="py-name">None</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 73</span>  <span class="py-line">                                <span class="py-keyword">import</span> <span class="py-name">shutil</span> </span>
<span class="py-lineno"> 74</span>  <span class="py-line">                                <span class="py-name">shutil</span><span class="py-op">.</span><span class="py-name">rmtree</span><span class="py-op">(</span><span class="py-name">tmpdir</span><span class="py-op">)</span> </span>
</div></div><span class="py-lineno"> 75</span>  <span class="py-line"> </span>
<a name="Policy"></a><div id="Policy-def"><span class="py-lineno"> 76</span> <a class="py-toggle" href="#" id="Policy-toggle" onclick="toggle('Policy'); return false;">-</a><span class="py-line"><span class="py-keyword">class</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html">Policy</a><span class="py-op">(</span><span class="py-base-class">object</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="Policy-expanded"><span class="py-lineno"> 77</span>  <span class="py-line">        <span class="py-docstring">"""Chooses a set of implementations based on a policy.</span> </span>
<span class="py-lineno"> 78</span>  <span class="py-line"><span class="py-docstring">        Typical use:</span> </span>
<span class="py-lineno"> 79</span>  <span class="py-line"><span class="py-docstring">         1. Create a Policy object, giving it the URI of the program to be run and a handler.</span> </span>
<span class="py-lineno"> 80</span>  <span class="py-line"><span class="py-docstring">         2. Call L{recalculate}. If more information is needed, the handler will be used to download it.</span> </span>
<span class="py-lineno"> 81</span>  <span class="py-line"><span class="py-docstring">         3. When all downloads are complete, the L{implementation} map contains the chosen versions.</span> </span>
<span class="py-lineno"> 82</span>  <span class="py-line"><span class="py-docstring">         4. Use L{get_uncached_implementations} to find where to get these versions and download them</span> </span>
<span class="py-lineno"> 83</span>  <span class="py-line"><span class="py-docstring">            using L{begin_impl_download}.</span> </span>
<span class="py-lineno"> 84</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno"> 85</span>  <span class="py-line"><span class="py-docstring">        @ivar root: URI of the root interface</span> </span>
<span class="py-lineno"> 86</span>  <span class="py-line"><span class="py-docstring">        @ivar implementation: chosen implementations</span> </span>
<span class="py-lineno"> 87</span>  <span class="py-line"><span class="py-docstring">        @type implementation: {model.Interface: model.Implementation or None}</span> </span>
<span class="py-lineno"> 88</span>  <span class="py-line"><span class="py-docstring">        @ivar watchers: callbacks to invoke after recalculating</span> </span>
<span class="py-lineno"> 89</span>  <span class="py-line"><span class="py-docstring">        @ivar help_with_testing: default stability policy</span> </span>
<span class="py-lineno"> 90</span>  <span class="py-line"><span class="py-docstring">        @type help_with_testing: bool</span> </span>
<span class="py-lineno"> 91</span>  <span class="py-line"><span class="py-docstring">        @ivar network_use: one of the model.network_* values</span> </span>
<span class="py-lineno"> 92</span>  <span class="py-line"><span class="py-docstring">        @ivar freshness: seconds allowed since last update</span> </span>
<span class="py-lineno"> 93</span>  <span class="py-line"><span class="py-docstring">        @type freshness: int</span> </span>
<span class="py-lineno"> 94</span>  <span class="py-line"><span class="py-docstring">        @ivar ready: whether L{implementation} is complete enough to run the program</span> </span>
<span class="py-lineno"> 95</span>  <span class="py-line"><span class="py-docstring">        @type ready: bool</span> </span>
<span class="py-lineno"> 96</span>  <span class="py-line"><span class="py-docstring">        @ivar handler: handler for main-loop integration</span> </span>
<span class="py-lineno"> 97</span>  <span class="py-line"><span class="py-docstring">        @type handler: L{handler.Handler}</span> </span>
<span class="py-lineno"> 98</span>  <span class="py-line"><span class="py-docstring">        @ivar restrictions: Currently known restrictions for each interface.</span> </span>
<span class="py-lineno"> 99</span>  <span class="py-line"><span class="py-docstring">        @type restrictions: {model.Interface -&gt; [model.Restriction]}</span> </span>
<span class="py-lineno">100</span>  <span class="py-line"><span class="py-docstring">        @ivar src: whether we are looking for source code</span> </span>
<span class="py-lineno">101</span>  <span class="py-line"><span class="py-docstring">        @type src: bool</span> </span>
<span class="py-lineno">102</span>  <span class="py-line"><span class="py-docstring">        @ivar stale_feeds: set of feeds which are present but haven't been checked for a long time</span> </span>
<span class="py-lineno">103</span>  <span class="py-line"><span class="py-docstring">        @type stale_feeds: set</span> </span>
<span class="py-lineno">104</span>  <span class="py-line"><span class="py-docstring">        """</span> </span>
<span class="py-lineno">105</span>  <span class="py-line">        <span id="link-28" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.__slots__
zeroinstall.injector.download.Download.__slots__
zeroinstall.injector.handler.Handler.__slots__
zeroinstall.injector.iface_cache.IfaceCache.__slots__
zeroinstall.injector.iface_cache.PendingFeed.__slots__
zeroinstall.injector.model.Dependency.__slots__
zeroinstall.injector.model.DownloadSource.__slots__
zeroinstall.injector.model.EnvironmentBinding.__slots__
zeroinstall.injector.model.Feed.__slots__
zeroinstall.injector.model.Implementation.__slots__
zeroinstall.injector.model.Interface.__slots__
zeroinstall.injector.model.Recipe.__slots__
zeroinstall.injector.model.Restriction.__slots__
zeroinstall.injector.model.RetrievalMethod.__slots__
zeroinstall.injector.model.Stability.__slots__
zeroinstall.injector.policy.Policy.__slots__
zeroinstall.injector.qdom.Element.__slots__
zeroinstall.injector.trust.TrustDB.__slots__
zeroinstall.zerostore.Stores.__slots__" class="py-name" href="#" onclick="doclink('link-28', '__slots__', 'Variable zeroinstall.injector.autopolicy.AutoPolicy.__slots__=zeroinstall.injector.autopolicy.AutoPolicy-class.html#__slots__,Variable zeroinstall.injector.download.Download.__slots__=zeroinstall.injector.download.Download-class.html#__slots__,Variable zeroinstall.injector.handler.Handler.__slots__=zeroinstall.injector.handler.Handler-class.html#__slots__,Variable zeroinstall.injector.iface_cache.IfaceCache.__slots__=zeroinstall.injector.iface_cache.IfaceCache-class.html#__slots__,Variable zeroinstall.injector.iface_cache.PendingFeed.__slots__=zeroinstall.injector.iface_cache.PendingFeed-class.html#__slots__,Variable zeroinstall.injector.model.Dependency.__slots__=zeroinstall.injector.model.Dependency-class.html#__slots__,Variable zeroinstall.injector.model.DownloadSource.__slots__=zeroinstall.injector.model.DownloadSource-class.html#__slots__,Variable zeroinstall.injector.model.EnvironmentBinding.__slots__=zeroinstall.injector.model.EnvironmentBinding-class.html#__slots__,Variable zeroinstall.injector.model.Feed.__slots__=zeroinstall.injector.model.Feed-class.html#__slots__,Variable zeroinstall.injector.model.Implementation.__slots__=zeroinstall.injector.model.Implementation-class.html#__slots__,Variable zeroinstall.injector.model.Interface.__slots__=zeroinstall.injector.model.Interface-class.html#__slots__,Variable zeroinstall.injector.model.Recipe.__slots__=zeroinstall.injector.model.Recipe-class.html#__slots__,Variable zeroinstall.injector.model.Restriction.__slots__=zeroinstall.injector.model.Restriction-class.html#__slots__,Variable zeroinstall.injector.model.RetrievalMethod.__slots__=zeroinstall.injector.model.RetrievalMethod-class.html#__slots__,Variable zeroinstall.injector.model.Stability.__slots__=zeroinstall.injector.model.Stability-class.html#__slots__,Variable zeroinstall.injector.policy.Policy.__slots__=zeroinstall.injector.policy.Policy-class.html#__slots__,Variable zeroinstall.injector.qdom.Element.__slots__=zeroinstall.injector.qdom.Element-class.html#__slots__,Variable zeroinstall.injector.trust.TrustDB.__slots__=zeroinstall.injector.trust.TrustDB-class.html#__slots__,Variable zeroinstall.zerostore.Stores.__slots__=zeroinstall.zerostore.Stores-class.html#__slots__'); return false;">__slots__</a></span></span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-string">'root'</span><span class="py-op">,</span> <span class="py-string">'implementation'</span><span class="py-op">,</span> <span class="py-string">'watchers'</span><span class="py-op">,</span> </span>
<span class="py-lineno">106</span>  <span class="py-line">                     <span class="py-string">'help_with_testing'</span><span class="py-op">,</span> <span class="py-string">'network_use'</span><span class="py-op">,</span> </span>
<span class="py-lineno">107</span>  <span class="py-line">                     <span class="py-string">'freshness'</span><span class="py-op">,</span> <span class="py-string">'ready'</span><span class="py-op">,</span> <span class="py-string">'handler'</span><span class="py-op">,</span> <span class="py-string">'_warned_offline'</span><span class="py-op">,</span> </span>
<span class="py-lineno">108</span>  <span class="py-line">                     <span class="py-string">'restrictions'</span><span class="py-op">,</span> <span class="py-string">'src'</span><span class="py-op">,</span> <span class="py-string">'root_restrictions'</span><span class="py-op">,</span> <span class="py-string">'stale_feeds'</span><span class="py-op">]</span> </span>
<span class="py-lineno">109</span>  <span class="py-line"> </span>
<a name="Policy.__init__"></a><div id="Policy.__init__-def"><span class="py-lineno">110</span> <a class="py-toggle" href="#" id="Policy.__init__-toggle" onclick="toggle('Policy.__init__'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#__init__">__init__</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">root</span><span class="py-op">,</span> <span class="py-param">handler</span> <span class="py-op">=</span> <span class="py-name">None</span><span class="py-op">,</span> <span class="py-param">src</span> <span class="py-op">=</span> <span class="py-name">False</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.__init__-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.__init__-expanded"><span class="py-lineno">111</span>  <span class="py-line">                <span class="py-docstring">"""</span> </span>
<span class="py-lineno">112</span>  <span class="py-line"><span class="py-docstring">                @param root: The URI of the root interface (the program we want to run).</span> </span>
<span class="py-lineno">113</span>  <span class="py-line"><span class="py-docstring">                @param handler: A handler for main-loop integration.</span> </span>
<span class="py-lineno">114</span>  <span class="py-line"><span class="py-docstring">                @type handler: L{zeroinstall.injector.handler.Handler}</span> </span>
<span class="py-lineno">115</span>  <span class="py-line"><span class="py-docstring">                @param src: Whether we are looking for source code.</span> </span>
<span class="py-lineno">116</span>  <span class="py-line"><span class="py-docstring">                @type src: bool</span> </span>
<span class="py-lineno">117</span>  <span class="py-line"><span class="py-docstring">                """</span> </span>
<span class="py-lineno">118</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">watchers</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span> </span>
<span class="py-lineno">119</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">help_with_testing</span> <span class="py-op">=</span> <span class="py-name">False</span> </span>
<span class="py-lineno">120</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">=</span> <span id="link-29" class="py-name"><a title="zeroinstall.injector.model.network_full" class="py-name" href="#" onclick="doclink('link-29', 'network_full', 'Variable zeroinstall.injector.model.network_full=zeroinstall.injector.model-module.html#network_full'); return false;">network_full</a></span></span> </span>
<span class="py-lineno">121</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">freshness</span> <span class="py-op">=</span> <span class="py-number">60</span> <span class="py-op">*</span> <span class="py-number">60</span> <span class="py-op">*</span> <span class="py-number">24</span> <span class="py-op">*</span> <span class="py-number">30</span> </span>
<span class="py-lineno">122</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">ready</span> <span class="py-op">=</span> <span class="py-name">False</span> </span>
<span class="py-lineno">123</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">src</span> <span class="py-op">=</span> <span class="py-name">src</span>                          <span class="py-comment"># Root impl must be a "src" machine type</span> </span>
<span class="py-lineno">124</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">restrictions</span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-op">}</span> </span>
<span class="py-lineno">125</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">stale_feeds</span> <span class="py-op">=</span> <span class="py-name">sets</span><span class="py-op">.</span><span class="py-name">Set</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">126</span>  <span class="py-line"> </span>
<span class="py-lineno">127</span>  <span class="py-line">                <span class="py-comment"># This is used in is_unusable() to check whether the impl is</span> </span>
<span class="py-lineno">128</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># for the root interface when looking for source. It is also</span> </span>
<span class="py-lineno">129</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># used to add restrictions to the root (e.g. --before and --not-before)</span> </span>
<span class="py-lineno">130</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root_restrictions</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span> </span>
<span class="py-lineno">131</span>  <span class="py-line"> </span>
<span class="py-lineno">132</span>  <span class="py-line">                <span class="py-comment"># If we need to download something but can't because we are offline,</span> </span>
<span class="py-lineno">133</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># warn the user. But only the first time.</span> </span>
<span class="py-lineno">134</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">_warned_offline</span> <span class="py-op">=</span> <span class="py-name">False</span> </span>
<span class="py-lineno">135</span>  <span class="py-line"> </span>
<span class="py-lineno">136</span>  <span class="py-line">                <span class="py-comment"># (allow self for backwards compat)</span> </span>
<span class="py-lineno">137</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">self</span><span class="py-op">.</span><span id="link-30" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-30', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span> <span class="py-op">=</span> <span id="link-31" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-31', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span> <span class="py-keyword">or</span> <span class="py-name">self</span> </span>
<span class="py-lineno">138</span>  <span class="py-line"> </span>
<span class="py-lineno">139</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Supported systems: '%s'"</span><span class="py-op">,</span> <span id="link-32" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-32', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-33" class="py-name"><a title="zeroinstall.injector.arch.os_ranks" class="py-name" href="#" onclick="doclink('link-33', 'os_ranks', 'Variable zeroinstall.injector.arch.os_ranks=zeroinstall.injector.arch-module.html#os_ranks'); return false;">os_ranks</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">140</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Supported processors: '%s'"</span><span class="py-op">,</span> <span id="link-34" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-34', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-35" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-35', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">141</span>  <span class="py-line"> </span>
<span class="py-lineno">142</span>  <span class="py-line">                <span class="py-name">path</span> <span class="py-op">=</span> <span id="link-36" class="py-name"><a title="zeroinstall.injector.basedir" class="py-name" href="#" onclick="doclink('link-36', 'basedir', 'Module zeroinstall.injector.basedir=zeroinstall.injector.basedir-module.html'); return false;">basedir</a></span></span><span class="py-op">.</span><span id="link-37" class="py-name"><a title="zeroinstall.injector.basedir.load_first_config" class="py-name" href="#" onclick="doclink('link-37', 'load_first_config', 'Function zeroinstall.injector.basedir.load_first_config()=zeroinstall.injector.basedir-module.html#load_first_config'); return false;">load_first_config</a></span></span><span class="py-op">(</span><span id="link-38" class="py-name"><a title="zeroinstall.injector.namespaces.config_site" class="py-name" href="#" onclick="doclink('link-38', 'config_site', 'Variable zeroinstall.injector.namespaces.config_site=zeroinstall.injector.namespaces-module.html#config_site'); return false;">config_site</a></span></span><span class="py-op">,</span> <span id="link-39" class="py-name"><a title="zeroinstall.injector.namespaces.config_prog" class="py-name" href="#" onclick="doclink('link-39', 'config_prog', 'Variable zeroinstall.injector.namespaces.config_prog=zeroinstall.injector.namespaces-module.html#config_prog'); return false;">config_prog</a></span></span><span class="py-op">,</span> <span class="py-string">'global'</span><span class="py-op">)</span> </span>
<span class="py-lineno">143</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">path</span><span class="py-op">:</span> </span>
<span class="py-lineno">144</span>  <span class="py-line">                        <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno">145</span>  <span class="py-line">                                <span class="py-name">config</span> <span class="py-op">=</span> <span class="py-name">ConfigParser</span><span class="py-op">.</span><span class="py-name">ConfigParser</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">146</span>  <span class="py-line">                                <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">read</span><span class="py-op">(</span><span class="py-name">path</span><span class="py-op">)</span> </span>
<span class="py-lineno">147</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">help_with_testing</span> <span class="py-op">=</span> <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">getboolean</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">,</span> </span>
<span class="py-lineno">148</span>  <span class="py-line">                                                                <span class="py-string">'help_with_testing'</span><span class="py-op">)</span> </span>
<span class="py-lineno">149</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">=</span> <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">,</span> <span class="py-string">'network_use'</span><span class="py-op">)</span> </span>
<span class="py-lineno">150</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">freshness</span> <span class="py-op">=</span> <span class="py-name">int</span><span class="py-op">(</span><span class="py-name">config</span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">,</span> <span class="py-string">'freshness'</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">151</span>  <span class="py-line">                                <span class="py-keyword">assert</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-keyword">in</span> <span id="link-40" class="py-name"><a title="zeroinstall.injector.model.network_levels" class="py-name" href="#" onclick="doclink('link-40', 'network_levels', 'Variable zeroinstall.injector.model.network_levels=zeroinstall.injector.model-module.html#network_levels'); return false;">network_levels</a></span></span> </span>
<span class="py-lineno">152</span>  <span class="py-line">                        <span class="py-keyword">except</span> <span class="py-name">Exception</span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">:</span> </span>
<span class="py-lineno">153</span>  <span class="py-line">                                <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Error loading config: %s"</span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">)</span> </span>
<span class="py-lineno">154</span>  <span class="py-line"> </span>
<span class="py-lineno">155</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span id="link-41" class="py-name"><a title="zeroinstall.injector.policy.Policy.set_root
zeroinstall.injector.policy.Policy.set_root" class="py-name" href="#" onclick="doclink('link-41', 'set_root', 'Method zeroinstall.injector.policy.Policy.set_root()=zeroinstall.injector.policy.Policy-class.html#set_root,Method zeroinstall.injector.policy.Policy.set_root()=zeroinstall.injector.policy.Policy-class.html#set_root'); return false;">set_root</a></span></span><span class="py-op">(</span><span class="py-name">root</span><span class="py-op">)</span> </span>
<span class="py-lineno">156</span>  <span class="py-line"> </span>
<span class="py-lineno">157</span>  <span class="py-line">                <span class="py-comment"># Probably need weakrefs here...</span> </span>
<span class="py-lineno">158</span>  <span class="py-line"><span class="py-comment"></span>                <span id="link-42" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-42', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-43" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.add_watcher" class="py-name" href="#" onclick="doclink('link-43', 'add_watcher', 'Method zeroinstall.injector.iface_cache.IfaceCache.add_watcher()=zeroinstall.injector.iface_cache.IfaceCache-class.html#add_watcher'); return false;">add_watcher</a></span></span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">)</span> </span>
<span class="py-lineno">159</span>  <span class="py-line">                <span id="link-44" class="py-name"><a title="zeroinstall.injector.trust.trust_db" class="py-name" href="#" onclick="doclink('link-44', 'trust_db', 'Variable zeroinstall.injector.trust.trust_db=zeroinstall.injector.trust-module.html#trust_db'); return false;">trust_db</a></span></span><span class="py-op">.</span><span class="py-name">watchers</span><span class="py-op">.</span><span class="py-name">append</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span id="link-45" class="py-name"><a title="zeroinstall.injector.policy.Policy.process_pending
zeroinstall.injector.policy.Policy.process_pending" class="py-name" href="#" onclick="doclink('link-45', 'process_pending', 'Method zeroinstall.injector.policy.Policy.process_pending()=zeroinstall.injector.policy.Policy-class.html#process_pending,Method zeroinstall.injector.policy.Policy.process_pending()=zeroinstall.injector.policy.Policy-class.html#process_pending'); return false;">process_pending</a></span></span><span class="py-op">)</span> </span>
</div><span class="py-lineno">160</span>  <span class="py-line">         </span>
<a name="Policy.set_root"></a><div id="Policy.set_root-def"><span class="py-lineno">161</span> <a class="py-toggle" href="#" id="Policy.set_root-toggle" onclick="toggle('Policy.set_root'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#set_root">set_root</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">root</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.set_root-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.set_root-expanded"><span class="py-lineno">162</span>  <span class="py-line">                <span class="py-docstring">"""Change the root interface URI."""</span> </span>
<span class="py-lineno">163</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">isinstance</span><span class="py-op">(</span><span class="py-name">root</span><span class="py-op">,</span> <span class="py-op">(</span><span class="py-name">str</span><span class="py-op">,</span> <span class="py-name">unicode</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">164</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root</span> <span class="py-op">=</span> <span class="py-name">root</span> </span>
<span class="py-lineno">165</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-op">}</span>                <span class="py-comment"># Interface -&gt; [Implementation | None]</span> </span>
</div><span class="py-lineno">166</span>  <span class="py-line"> </span>
<a name="Policy.save_config"></a><div id="Policy.save_config-def"><span class="py-lineno">167</span> <a class="py-toggle" href="#" id="Policy.save_config-toggle" onclick="toggle('Policy.save_config'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#save_config">save_config</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.save_config-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.save_config-expanded"><span class="py-lineno">168</span>  <span class="py-line">                <span class="py-docstring">"""Write global settings."""</span> </span>
<span class="py-lineno">169</span>  <span class="py-line">                <span class="py-name">config</span> <span class="py-op">=</span> <span class="py-name">ConfigParser</span><span class="py-op">.</span><span class="py-name">ConfigParser</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">170</span>  <span class="py-line">                <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">add_section</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">)</span> </span>
<span class="py-lineno">171</span>  <span class="py-line"> </span>
<span class="py-lineno">172</span>  <span class="py-line">                <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">set</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">,</span> <span class="py-string">'help_with_testing'</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">help_with_testing</span><span class="py-op">)</span> </span>
<span class="py-lineno">173</span>  <span class="py-line">                <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">set</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">,</span> <span class="py-string">'network_use'</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span><span class="py-op">)</span> </span>
<span class="py-lineno">174</span>  <span class="py-line">                <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">set</span><span class="py-op">(</span><span class="py-string">'global'</span><span class="py-op">,</span> <span class="py-string">'freshness'</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">freshness</span><span class="py-op">)</span> </span>
<span class="py-lineno">175</span>  <span class="py-line"> </span>
<span class="py-lineno">176</span>  <span class="py-line">                <span class="py-name">path</span> <span class="py-op">=</span> <span id="link-46" class="py-name"><a title="zeroinstall.injector.basedir" class="py-name" href="#" onclick="doclink('link-46', 'basedir', 'Module zeroinstall.injector.basedir=zeroinstall.injector.basedir-module.html'); return false;">basedir</a></span></span><span class="py-op">.</span><span id="link-47" class="py-name"><a title="zeroinstall.injector.basedir.save_config_path" class="py-name" href="#" onclick="doclink('link-47', 'save_config_path', 'Function zeroinstall.injector.basedir.save_config_path()=zeroinstall.injector.basedir-module.html#save_config_path'); return false;">save_config_path</a></span></span><span class="py-op">(</span><span id="link-48" class="py-name"><a title="zeroinstall.injector.namespaces.config_site" class="py-name" href="#" onclick="doclink('link-48', 'config_site', 'Variable zeroinstall.injector.namespaces.config_site=zeroinstall.injector.namespaces-module.html#config_site'); return false;">config_site</a></span></span><span class="py-op">,</span> <span id="link-49" class="py-name"><a title="zeroinstall.injector.namespaces.config_prog" class="py-name" href="#" onclick="doclink('link-49', 'config_prog', 'Variable zeroinstall.injector.namespaces.config_prog=zeroinstall.injector.namespaces-module.html#config_prog'); return false;">config_prog</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">177</span>  <span class="py-line">                <span class="py-name">path</span> <span class="py-op">=</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">path</span><span class="py-op">.</span><span class="py-name">join</span><span class="py-op">(</span><span class="py-name">path</span><span class="py-op">,</span> <span class="py-string">'global'</span><span class="py-op">)</span> </span>
<span class="py-lineno">178</span>  <span class="py-line">                <span class="py-name">config</span><span class="py-op">.</span><span class="py-name">write</span><span class="py-op">(</span><span class="py-name">file</span><span class="py-op">(</span><span class="py-name">path</span> <span class="py-op">+</span> <span class="py-string">'.new'</span><span class="py-op">,</span> <span class="py-string">'w'</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">179</span>  <span class="py-line">                <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">rename</span><span class="py-op">(</span><span class="py-name">path</span> <span class="py-op">+</span> <span class="py-string">'.new'</span><span class="py-op">,</span> <span class="py-name">path</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">180</span>  <span class="py-line">         </span>
<a name="Policy.process_pending"></a><div id="Policy.process_pending-def"><span class="py-lineno">181</span> <a class="py-toggle" href="#" id="Policy.process_pending-toggle" onclick="toggle('Policy.process_pending'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#process_pending">process_pending</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.process_pending-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.process_pending-expanded"><span class="py-lineno">182</span>  <span class="py-line">                <span class="py-docstring">"""For each pending feed, either import it fully (if we now</span> </span>
<span class="py-lineno">183</span>  <span class="py-line"><span class="py-docstring">                trust one of the signatures) or start performing whatever action</span> </span>
<span class="py-lineno">184</span>  <span class="py-line"><span class="py-docstring">                is needed next (either downloading a key or confirming a</span> </span>
<span class="py-lineno">185</span>  <span class="py-line"><span class="py-docstring">                fingerprint).</span> </span>
<span class="py-lineno">186</span>  <span class="py-line"><span class="py-docstring">                @since: 0.25</span> </span>
<span class="py-lineno">187</span>  <span class="py-line"><span class="py-docstring">                """</span> </span>
<span class="py-lineno">188</span>  <span class="py-line">                <span class="py-comment"># process_pending must never be called from recalculate</span> </span>
<span class="py-lineno">189</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno">190</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">pending</span> <span class="py-keyword">in</span> <span id="link-50" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-50', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span class="py-name">pending</span><span class="py-op">.</span><span class="py-name">values</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">191</span>  <span class="py-line">                        <span class="py-name">pending</span><span class="py-op">.</span><span id="link-51" class="py-name"><a title="zeroinstall.injector.iface_cache.PendingFeed.begin_key_downloads" class="py-name" href="#" onclick="doclink('link-51', 'begin_key_downloads', 'Method zeroinstall.injector.iface_cache.PendingFeed.begin_key_downloads()=zeroinstall.injector.iface_cache.PendingFeed-class.html#begin_key_downloads'); return false;">begin_key_downloads</a></span></span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span id="link-52" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-52', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span><span class="py-op">,</span> <span class="py-keyword">lambda</span> <span class="py-name">pending</span> <span class="py-op">=</span> <span class="py-name">pending</span><span class="py-op">:</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">_keys_ready</span><span class="py-op">(</span><span class="py-name">pending</span><span class="py-op">)</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">192</span>  <span class="py-line">         </span>
<a name="Policy._keys_ready"></a><div id="Policy._keys_ready-def"><span class="py-lineno">193</span> <a class="py-toggle" href="#" id="Policy._keys_ready-toggle" onclick="toggle('Policy._keys_ready'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#_keys_ready">_keys_ready</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">pending</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy._keys_ready-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy._keys_ready-expanded"><span class="py-lineno">194</span>  <span class="py-line">                <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno">195</span>  <span class="py-line">                        <span class="py-name">iface</span> <span class="py-op">=</span> <span id="link-53" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-53', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-54" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-54', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">pending</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span> </span>
<span class="py-lineno">196</span>  <span class="py-line">                        <span class="py-comment"># Note: this may call recalculate, but it shouldn't do any harm</span> </span>
<span class="py-lineno">197</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-comment"># (just a bit slow)</span> </span>
<span class="py-lineno">198</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-name">updated</span> <span class="py-op">=</span> <span id="link-55" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-55', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-56" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.update_interface_if_trusted" class="py-name" href="#" onclick="doclink('link-56', 'update_interface_if_trusted', 'Method zeroinstall.injector.iface_cache.IfaceCache.update_interface_if_trusted()=zeroinstall.injector.iface_cache.IfaceCache-class.html#update_interface_if_trusted'); return false;">update_interface_if_trusted</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">pending</span><span class="py-op">.</span><span class="py-name">sigs</span><span class="py-op">,</span> <span class="py-name">pending</span><span class="py-op">.</span><span class="py-name">new_xml</span><span class="py-op">)</span> </span>
<span class="py-lineno">199</span>  <span class="py-line">                <span class="py-keyword">except</span> <span id="link-57" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-57', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">:</span> </span>
<span class="py-lineno">200</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-58" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-58', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span><span class="py-op">.</span><span id="link-59" class="py-name"><a title="zeroinstall.injector.background.BackgroundHandler.report_error
zeroinstall.injector.handler.Handler.report_error" class="py-name" href="#" onclick="doclink('link-59', 'report_error', 'Method zeroinstall.injector.background.BackgroundHandler.report_error()=zeroinstall.injector.background.BackgroundHandler-class.html#report_error,Method zeroinstall.injector.handler.Handler.report_error()=zeroinstall.injector.handler.Handler-class.html#report_error'); return false;">report_error</a></span></span><span class="py-op">(</span><span class="py-name">ex</span><span class="py-op">)</span> </span>
<span class="py-lineno">201</span>  <span class="py-line">                        <span class="py-comment"># Ignore the problematic new version and continue...</span> </span>
<span class="py-lineno">202</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">203</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">updated</span><span class="py-op">:</span> </span>
<span class="py-lineno">204</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span id="link-60" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-60', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span><span class="py-op">.</span><span id="link-61" class="py-name"><a title="zeroinstall.injector.background.BackgroundHandler.confirm_trust_keys
zeroinstall.injector.handler.Handler.confirm_trust_keys" class="py-name" href="#" onclick="doclink('link-61', 'confirm_trust_keys', 'Method zeroinstall.injector.background.BackgroundHandler.confirm_trust_keys()=zeroinstall.injector.background.BackgroundHandler-class.html#confirm_trust_keys,Method zeroinstall.injector.handler.Handler.confirm_trust_keys()=zeroinstall.injector.handler.Handler-class.html#confirm_trust_keys'); return false;">confirm_trust_keys</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">pending</span><span class="py-op">.</span><span class="py-name">sigs</span><span class="py-op">,</span> <span class="py-name">pending</span><span class="py-op">.</span><span class="py-name">new_xml</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">205</span>  <span class="py-line"> </span>
<a name="Policy.recalculate"></a><div id="Policy.recalculate-def"><span class="py-lineno">206</span> <a class="py-toggle" href="#" id="Policy.recalculate-toggle" onclick="toggle('Policy.recalculate'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#recalculate">recalculate</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">fetch_stale_interfaces</span> <span class="py-op">=</span> <span class="py-name">True</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.recalculate-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.recalculate-expanded"><span class="py-lineno">207</span>  <span class="py-line">                <span class="py-docstring">"""Try to choose a set of implementations.</span> </span>
<span class="py-lineno">208</span>  <span class="py-line"><span class="py-docstring">                This may start downloading more interfaces, but will return immediately.</span> </span>
<span class="py-lineno">209</span>  <span class="py-line"><span class="py-docstring">                @param fetch_stale_interfaces: whether to begin downloading interfaces which are present but haven't</span> </span>
<span class="py-lineno">210</span>  <span class="py-line"><span class="py-docstring">                been checked within the L{freshness} period</span> </span>
<span class="py-lineno">211</span>  <span class="py-line"><span class="py-docstring">                @type fetch_stale_interfaces: bool</span> </span>
<span class="py-lineno">212</span>  <span class="py-line"><span class="py-docstring">                @postcondition: L{ready} indicates whether a possible set of implementations was chosen</span> </span>
<span class="py-lineno">213</span>  <span class="py-line"><span class="py-docstring">                @note: A policy may be ready before all feeds have been downloaded. As new feeds</span> </span>
<span class="py-lineno">214</span>  <span class="py-line"><span class="py-docstring">                arrive, the chosen versions may change.</span> </span>
<span class="py-lineno">215</span>  <span class="py-line"><span class="py-docstring">                """</span> </span>
<span class="py-lineno">216</span>  <span class="py-line"> </span>
<span class="py-lineno">217</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">stale_feeds</span> <span class="py-op">=</span> <span class="py-name">sets</span><span class="py-op">.</span><span class="py-name">Set</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">218</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">restrictions</span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-op">}</span> </span>
<span class="py-lineno">219</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-op">}</span> </span>
<span class="py-lineno">220</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">ready</span> <span class="py-op">=</span> <span class="py-name">True</span> </span>
<span class="py-lineno">221</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Recalculate! root = %s"</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root</span><span class="py-op">)</span> </span>
<span class="py-lineno">222</span>  <span class="py-line">                <span class="py-keyword">def</span> <span class="py-def-name">process</span><span class="py-op">(</span><span class="py-param">dep</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">223</span>  <span class="py-line">                        <span class="py-name">iface</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-62" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-62', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">dep</span><span class="py-op">.</span><span class="py-name">interface</span><span class="py-op">)</span> </span>
<span class="py-lineno">224</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">iface</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">:</span> </span>
<span class="py-lineno">225</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Interface requested twice; skipping second %s"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">226</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-name">dep</span><span class="py-op">.</span><span class="py-name">restrictions</span><span class="py-op">:</span> </span>
<span class="py-lineno">227</span>  <span class="py-line">                                        <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Interface requested twice; I've already chosen an implementation "</span> </span>
<span class="py-lineno">228</span>  <span class="py-line">                                                <span class="py-string">"of '%s' but there are more restrictions! Ignoring the second set."</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">229</span>  <span class="py-line">                                <span class="py-keyword">return</span> </span>
<span class="py-lineno">230</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">[</span><span class="py-name">iface</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">None</span>       <span class="py-comment"># Avoid cycles</span> </span>
<span class="py-lineno">231</span>  <span class="py-line"> </span>
<span class="py-lineno">232</span>  <span class="py-line">                        <span class="py-keyword">assert</span> <span class="py-name">iface</span> <span class="py-keyword">not</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">restrictions</span> </span>
<span class="py-lineno">233</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">restrictions</span><span class="py-op">[</span><span class="py-name">iface</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">dep</span><span class="py-op">.</span><span class="py-name">restrictions</span> </span>
<span class="py-lineno">234</span>  <span class="py-line"> </span>
<span class="py-lineno">235</span>  <span class="py-line">                        <span class="py-name">impl</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">_get_best_implementation</span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">236</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">:</span> </span>
<span class="py-lineno">237</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Will use implementation %s (version %s)"</span><span class="py-op">,</span> <span class="py-name">impl</span><span class="py-op">,</span> <span class="py-name">impl</span><span class="py-op">.</span><span id="link-63" class="py-name"><a title="zeroinstall.injector.model.Implementation.get_version" class="py-name" href="#" onclick="doclink('link-63', 'get_version', 'Method zeroinstall.injector.model.Implementation.get_version()=zeroinstall.injector.model.Implementation-class.html#get_version'); return false;">get_version</a></span></span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">238</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">[</span><span class="py-name">iface</span><span class="py-op">]</span> <span class="py-op">=</span> <span class="py-name">impl</span> </span>
<span class="py-lineno">239</span>  <span class="py-line">                                <span class="py-keyword">for</span> <span class="py-name">d</span> <span class="py-keyword">in</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">dependencies</span><span class="py-op">.</span><span class="py-name">values</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">240</span>  <span class="py-line">                                        <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Considering dependency %s"</span><span class="py-op">,</span> <span class="py-name">d</span><span class="py-op">)</span> </span>
<span class="py-lineno">241</span>  <span class="py-line">                                        <span class="py-name">process</span><span class="py-op">(</span><span class="py-name">d</span><span class="py-op">)</span> </span>
<span class="py-lineno">242</span>  <span class="py-line">                        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">243</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"No implementation chould be chosen yet"</span><span class="py-op">)</span><span class="py-op">;</span> </span>
<span class="py-lineno">244</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">ready</span> <span class="py-op">=</span> <span class="py-name">False</span> </span>
</div><span class="py-lineno">245</span>  <span class="py-line">                <span class="py-name">process</span><span class="py-op">(</span><span id="link-64" class="py-name"><a title="zeroinstall.injector.model.Dependency" class="py-name" href="#" onclick="doclink('link-64', 'Dependency', 'Class zeroinstall.injector.model.Dependency=zeroinstall.injector.model.Dependency-class.html'); return false;">Dependency</a></span></span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root</span><span class="py-op">,</span> <span class="py-name">restrictions</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root_restrictions</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">246</span>  <span class="py-line"> </span>
<span class="py-lineno">247</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">fetch_stale_interfaces</span> <span class="py-keyword">and</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">!=</span> <span id="link-65" class="py-name"><a title="zeroinstall.injector.model.network_offline" class="py-name" href="#" onclick="doclink('link-65', 'network_offline', 'Variable zeroinstall.injector.model.network_offline=zeroinstall.injector.model-module.html#network_offline'); return false;">network_offline</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">248</span>  <span class="py-line">                        <span class="py-keyword">for</span> <span class="py-name">stale</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">stale_feeds</span><span class="py-op">:</span> </span>
<span class="py-lineno">249</span>  <span class="py-line">                                <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"Checking for updates to stale feed %s"</span><span class="py-op">,</span> <span class="py-name">stale</span><span class="py-op">)</span> </span>
<span class="py-lineno">250</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span id="link-66" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download
zeroinstall.injector.policy.Policy.begin_iface_download" class="py-name" href="#" onclick="doclink('link-66', 'begin_iface_download', 'Method zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download()=zeroinstall.injector.autopolicy.AutoPolicy-class.html#begin_iface_download,Method zeroinstall.injector.policy.Policy.begin_iface_download()=zeroinstall.injector.policy.Policy-class.html#begin_iface_download'); return false;">begin_iface_download</a></span></span><span class="py-op">(</span><span class="py-name">stale</span><span class="py-op">,</span> <span class="py-name">False</span><span class="py-op">)</span> </span>
<span class="py-lineno">251</span>  <span class="py-line"> </span>
<span class="py-lineno">252</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">w</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">watchers</span><span class="py-op">:</span> <span class="py-name">w</span><span class="py-op">(</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">253</span>  <span class="py-line">         </span>
<span class="py-lineno">254</span>  <span class="py-line">        <span class="py-comment"># Only to be called from recalculate, as it is quite slow.</span> </span>
<span class="py-lineno">255</span>  <span class="py-line"><span class="py-comment"></span>        <span class="py-comment"># Use the results stored in self.implementation instead.</span> </span>
<a name="Policy._get_best_implementation"></a><div id="Policy._get_best_implementation-def"><span class="py-lineno">256</span> <a class="py-toggle" href="#" id="Policy._get_best_implementation-toggle" onclick="toggle('Policy._get_best_implementation'); return false;">-</a><span class="py-line"><span class="py-comment"></span>        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#_get_best_implementation">_get_best_implementation</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">iface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy._get_best_implementation-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy._get_best_implementation-expanded"><span class="py-lineno">257</span>  <span class="py-line">                <span class="py-name">impls</span> <span class="py-op">=</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">.</span><span class="py-name">values</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">258</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">f</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-67" class="py-name"><a title="zeroinstall.injector.policy.Policy.usable_feeds
zeroinstall.injector.policy.Policy.usable_feeds" class="py-name" href="#" onclick="doclink('link-67', 'usable_feeds', 'Method zeroinstall.injector.policy.Policy.usable_feeds()=zeroinstall.injector.policy.Policy-class.html#usable_feeds,Method zeroinstall.injector.policy.Policy.usable_feeds()=zeroinstall.injector.policy.Policy-class.html#usable_feeds'); return false;">usable_feeds</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">259</span>  <span class="py-line">                        <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Processing feed %s"</span><span class="py-op">,</span> <span class="py-name">f</span><span class="py-op">)</span> </span>
<span class="py-lineno">260</span>  <span class="py-line">                        <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno">261</span>  <span class="py-line">                                <span class="py-name">feed_iface</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-68" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-68', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">f</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">262</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">name</span> <span class="py-keyword">and</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">uri</span> <span class="py-keyword">not</span> <span class="py-keyword">in</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">feed_for</span><span class="py-op">:</span> </span>
<span class="py-lineno">263</span>  <span class="py-line">                                        <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Missing &lt;feed-for&gt; for '%s' in '%s'"</span><span class="py-op">,</span> </span>
<span class="py-lineno">264</span>  <span class="py-line">                                                <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">,</span> <span class="py-name">f</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">265</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">:</span> </span>
<span class="py-lineno">266</span>  <span class="py-line">                                        <span class="py-name">impls</span><span class="py-op">.</span><span class="py-name">extend</span><span class="py-op">(</span><span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">.</span><span class="py-name">values</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">267</span>  <span class="py-line">                        <span class="py-keyword">except</span> <span id="link-69" class="py-name"><a title="zeroinstall.NeedDownload" class="py-name" href="#" onclick="doclink('link-69', 'NeedDownload', 'Class zeroinstall.NeedDownload=zeroinstall.NeedDownload-class.html'); return false;">NeedDownload</a></span></span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">:</span> </span>
<span class="py-lineno">268</span>  <span class="py-line">                                <span class="py-keyword">raise</span> <span class="py-name">ex</span> </span>
<span class="py-lineno">269</span>  <span class="py-line">                        <span class="py-keyword">except</span> <span class="py-name">Exception</span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">:</span> </span>
<span class="py-lineno">270</span>  <span class="py-line">                                <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Failed to load feed %s for %s: %s"</span><span class="py-op">,</span> </span>
<span class="py-lineno">271</span>  <span class="py-line">                                        <span class="py-name">f</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">str</span><span class="py-op">(</span><span class="py-name">ex</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">272</span>  <span class="py-line"> </span>
<span class="py-lineno">273</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"get_best_implementation(%s), with feeds: %s"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">feeds</span><span class="py-op">)</span> </span>
<span class="py-lineno">274</span>  <span class="py-line"> </span>
<span class="py-lineno">275</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">impls</span><span class="py-op">:</span> </span>
<span class="py-lineno">276</span>  <span class="py-line">                        <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"Interface %s has no implementations!"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">277</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">None</span> </span>
<span class="py-lineno">278</span>  <span class="py-line">                <span class="py-name">best</span> <span class="py-op">=</span> <span class="py-name">impls</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> </span>
<span class="py-lineno">279</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">x</span> <span class="py-keyword">in</span> <span class="py-name">impls</span><span class="py-op">[</span><span class="py-number">1</span><span class="py-op">:</span><span class="py-op">]</span><span class="py-op">:</span> </span>
<span class="py-lineno">280</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-70" class="py-name"><a title="zeroinstall.injector.policy.Policy.compare
zeroinstall.injector.policy.Policy.compare" class="py-name" href="#" onclick="doclink('link-70', 'compare', 'Method zeroinstall.injector.policy.Policy.compare()=zeroinstall.injector.policy.Policy-class.html#compare,Method zeroinstall.injector.policy.Policy.compare()=zeroinstall.injector.policy.Policy-class.html#compare'); return false;">compare</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">x</span><span class="py-op">,</span> <span class="py-name">best</span><span class="py-op">)</span> <span class="py-op">&lt;</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno">281</span>  <span class="py-line">                                <span class="py-name">best</span> <span class="py-op">=</span> <span class="py-name">x</span> </span>
<span class="py-lineno">282</span>  <span class="py-line">                <span class="py-name">unusable</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-71" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_unusable_reason
zeroinstall.injector.policy.Policy.get_unusable_reason" class="py-name" href="#" onclick="doclink('link-71', 'get_unusable_reason', 'Method zeroinstall.injector.policy.Policy.get_unusable_reason()=zeroinstall.injector.policy.Policy-class.html#get_unusable_reason,Method zeroinstall.injector.policy.Policy.get_unusable_reason()=zeroinstall.injector.policy.Policy-class.html#get_unusable_reason'); return false;">get_unusable_reason</a></span></span><span class="py-op">(</span><span class="py-name">best</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">restrictions</span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">,</span> <span class="py-op">[</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">283</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">unusable</span><span class="py-op">:</span> </span>
<span class="py-lineno">284</span>  <span class="py-line">                        <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"Best implementation of %s is %s, but unusable (%s)"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">best</span><span class="py-op">,</span> <span class="py-name">unusable</span><span class="py-op">)</span> </span>
<span class="py-lineno">285</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">None</span> </span>
<span class="py-lineno">286</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">best</span> </span>
</div><span class="py-lineno">287</span>  <span class="py-line">         </span>
<a name="Policy.compare"></a><div id="Policy.compare-def"><span class="py-lineno">288</span> <a class="py-toggle" href="#" id="Policy.compare-toggle" onclick="toggle('Policy.compare'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#compare">compare</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">interface</span><span class="py-op">,</span> <span class="py-param">b</span><span class="py-op">,</span> <span class="py-param">a</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.compare-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.compare-expanded"><span class="py-lineno">289</span>  <span class="py-line">                <span class="py-docstring">"""Compare a and b to see which would be chosen first.</span> </span>
<span class="py-lineno">290</span>  <span class="py-line"><span class="py-docstring">                @param interface: The interface we are trying to resolve, which may</span> </span>
<span class="py-lineno">291</span>  <span class="py-line"><span class="py-docstring">                not be the interface of a or b if they are from feeds.</span> </span>
<span class="py-lineno">292</span>  <span class="py-line"><span class="py-docstring">                @rtype: int"""</span> </span>
<span class="py-lineno">293</span>  <span class="py-line">                <span class="py-name">restrictions</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">restrictions</span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">,</span> <span class="py-op">[</span><span class="py-op">]</span><span class="py-op">)</span> </span>
<span class="py-lineno">294</span>  <span class="py-line"> </span>
<span class="py-lineno">295</span>  <span class="py-line">                <span class="py-name">a_stab</span> <span class="py-op">=</span> <span class="py-name">a</span><span class="py-op">.</span><span id="link-72" class="py-name"><a title="zeroinstall.injector.model.Implementation.get_stability" class="py-name" href="#" onclick="doclink('link-72', 'get_stability', 'Method zeroinstall.injector.model.Implementation.get_stability()=zeroinstall.injector.model.Implementation-class.html#get_stability'); return false;">get_stability</a></span></span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">296</span>  <span class="py-line">                <span class="py-name">b_stab</span> <span class="py-op">=</span> <span class="py-name">b</span><span class="py-op">.</span><span id="link-73" class="py-name"><a title="zeroinstall.injector.model.Implementation.get_stability" class="py-name" href="#" onclick="doclink('link-73', 'get_stability', 'Method zeroinstall.injector.model.Implementation.get_stability()=zeroinstall.injector.model.Implementation-class.html#get_stability'); return false;">get_stability</a></span></span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">297</span>  <span class="py-line"> </span>
<span class="py-lineno">298</span>  <span class="py-line">                <span class="py-comment"># Usable ones come first</span> </span>
<span class="py-lineno">299</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span id="link-74" class="py-name"><a title="zeroinstall.injector.policy.Policy.is_unusable
zeroinstall.injector.policy.Policy.is_unusable" class="py-name" href="#" onclick="doclink('link-74', 'is_unusable', 'Method zeroinstall.injector.policy.Policy.is_unusable()=zeroinstall.injector.policy.Policy-class.html#is_unusable,Method zeroinstall.injector.policy.Policy.is_unusable()=zeroinstall.injector.policy.Policy-class.html#is_unusable'); return false;">is_unusable</a></span></span><span class="py-op">(</span><span class="py-name">b</span><span class="py-op">,</span> <span class="py-name">restrictions</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-75" class="py-name"><a title="zeroinstall.injector.policy.Policy.is_unusable
zeroinstall.injector.policy.Policy.is_unusable" class="py-name" href="#" onclick="doclink('link-75', 'is_unusable', 'Method zeroinstall.injector.policy.Policy.is_unusable()=zeroinstall.injector.policy.Policy-class.html#is_unusable,Method zeroinstall.injector.policy.Policy.is_unusable()=zeroinstall.injector.policy.Policy-class.html#is_unusable'); return false;">is_unusable</a></span></span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">,</span> <span class="py-name">restrictions</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">300</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">301</span>  <span class="py-line"> </span>
<span class="py-lineno">302</span>  <span class="py-line">                <span class="py-comment"># Preferred versions come first</span> </span>
<span class="py-lineno">303</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">a_stab</span> <span class="py-op">==</span> <span id="link-76" class="py-name"><a title="zeroinstall.injector.model.preferred" class="py-name" href="#" onclick="doclink('link-76', 'preferred', 'Variable zeroinstall.injector.model.preferred=zeroinstall.injector.model-module.html#preferred'); return false;">preferred</a></span></span><span class="py-op">,</span> <span class="py-name">b_stab</span> <span class="py-op">==</span> <span id="link-77" class="py-name"><a title="zeroinstall.injector.model.preferred" class="py-name" href="#" onclick="doclink('link-77', 'preferred', 'Variable zeroinstall.injector.model.preferred=zeroinstall.injector.model-module.html#preferred'); return false;">preferred</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">304</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">305</span>  <span class="py-line"> </span>
<span class="py-lineno">306</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">!=</span> <span id="link-78" class="py-name"><a title="zeroinstall.injector.model.network_full" class="py-name" href="#" onclick="doclink('link-78', 'network_full', 'Variable zeroinstall.injector.model.network_full=zeroinstall.injector.model-module.html#network_full'); return false;">network_full</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">307</span>  <span class="py-line">                        <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span id="link-79" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_cached
zeroinstall.injector.policy.Policy.get_cached" class="py-name" href="#" onclick="doclink('link-79', 'get_cached', 'Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached,Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached'); return false;">get_cached</a></span></span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-80" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_cached
zeroinstall.injector.policy.Policy.get_cached" class="py-name" href="#" onclick="doclink('link-80', 'get_cached', 'Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached,Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached'); return false;">get_cached</a></span></span><span class="py-op">(</span><span class="py-name">b</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">308</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">309</span>  <span class="py-line"> </span>
<span class="py-lineno">310</span>  <span class="py-line">                <span class="py-comment"># Stability</span> </span>
<span class="py-lineno">311</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">stab_policy</span> <span class="py-op">=</span> <span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">stability_policy</span> </span>
<span class="py-lineno">312</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">stab_policy</span><span class="py-op">:</span> </span>
<span class="py-lineno">313</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">help_with_testing</span><span class="py-op">:</span> <span class="py-name">stab_policy</span> <span class="py-op">=</span> <span id="link-81" class="py-name"><a title="zeroinstall.injector.model.testing" class="py-name" href="#" onclick="doclink('link-81', 'testing', 'Variable zeroinstall.injector.model.testing=zeroinstall.injector.model-module.html#testing'); return false;">testing</a></span></span> </span>
<span class="py-lineno">314</span>  <span class="py-line">                        <span class="py-keyword">else</span><span class="py-op">:</span> <span class="py-name">stab_policy</span> <span class="py-op">=</span> <span id="link-82" class="py-name"><a title="zeroinstall.injector.model.stable" class="py-name" href="#" onclick="doclink('link-82', 'stable', 'Variable zeroinstall.injector.model.stable=zeroinstall.injector.model-module.html#stable'); return false;">stable</a></span></span> </span>
<span class="py-lineno">315</span>  <span class="py-line"> </span>
<span class="py-lineno">316</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">a_stab</span> <span class="py-op">&gt;=</span> <span class="py-name">stab_policy</span><span class="py-op">:</span> <span class="py-name">a_stab</span> <span class="py-op">=</span> <span id="link-83" class="py-name"><a title="zeroinstall.injector.model.preferred" class="py-name" href="#" onclick="doclink('link-83', 'preferred', 'Variable zeroinstall.injector.model.preferred=zeroinstall.injector.model-module.html#preferred'); return false;">preferred</a></span></span> </span>
<span class="py-lineno">317</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">b_stab</span> <span class="py-op">&gt;=</span> <span class="py-name">stab_policy</span><span class="py-op">:</span> <span class="py-name">b_stab</span> <span class="py-op">=</span> <span id="link-84" class="py-name"><a title="zeroinstall.injector.model.preferred" class="py-name" href="#" onclick="doclink('link-84', 'preferred', 'Variable zeroinstall.injector.model.preferred=zeroinstall.injector.model-module.html#preferred'); return false;">preferred</a></span></span> </span>
<span class="py-lineno">318</span>  <span class="py-line"> </span>
<span class="py-lineno">319</span>  <span class="py-line">                <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">a_stab</span><span class="py-op">,</span> <span class="py-name">b_stab</span><span class="py-op">)</span> </span>
<span class="py-lineno">320</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">321</span>  <span class="py-line">                 </span>
<span class="py-lineno">322</span>  <span class="py-line">                <span class="py-comment"># Newer versions come before older ones</span> </span>
<span class="py-lineno">323</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">.</span><span id="link-85" class="py-name"><a title="zeroinstall.version" class="py-name" href="#" onclick="doclink('link-85', 'version', 'Variable zeroinstall.version=zeroinstall-module.html#version'); return false;">version</a></span></span><span class="py-op">,</span> <span class="py-name">b</span><span class="py-op">.</span><span id="link-86" class="py-name"><a title="zeroinstall.version" class="py-name" href="#" onclick="doclink('link-86', 'version', 'Variable zeroinstall.version=zeroinstall-module.html#version'); return false;">version</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">324</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">325</span>  <span class="py-line"> </span>
<span class="py-lineno">326</span>  <span class="py-line">                <span class="py-comment"># Get best OS</span> </span>
<span class="py-lineno">327</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span id="link-87" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-87', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-88" class="py-name"><a title="zeroinstall.injector.arch.os_ranks" class="py-name" href="#" onclick="doclink('link-88', 'os_ranks', 'Variable zeroinstall.injector.arch.os_ranks=zeroinstall.injector.arch-module.html#os_ranks'); return false;">os_ranks</a></span></span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">.</span><span class="py-name">os</span><span class="py-op">,</span> <span class="py-name">None</span><span class="py-op">)</span><span class="py-op">,</span> </span>
<span class="py-lineno">328</span>  <span class="py-line">                        <span id="link-89" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-89', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-90" class="py-name"><a title="zeroinstall.injector.arch.os_ranks" class="py-name" href="#" onclick="doclink('link-90', 'os_ranks', 'Variable zeroinstall.injector.arch.os_ranks=zeroinstall.injector.arch-module.html#os_ranks'); return false;">os_ranks</a></span></span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-name">b</span><span class="py-op">.</span><span class="py-name">os</span><span class="py-op">,</span> <span class="py-name">None</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">329</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">330</span>  <span class="py-line"> </span>
<span class="py-lineno">331</span>  <span class="py-line">                <span class="py-comment"># Get best machine</span> </span>
<span class="py-lineno">332</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span id="link-91" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-91', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-92" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-92', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">.</span><span class="py-name">machine</span><span class="py-op">,</span> <span class="py-name">None</span><span class="py-op">)</span><span class="py-op">,</span> </span>
<span class="py-lineno">333</span>  <span class="py-line">                        <span id="link-93" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-93', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-94" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-94', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span><span class="py-op">.</span><span class="py-name">get</span><span class="py-op">(</span><span class="py-name">b</span><span class="py-op">.</span><span class="py-name">machine</span><span class="py-op">,</span> <span class="py-name">None</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">334</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">335</span>  <span class="py-line"> </span>
<span class="py-lineno">336</span>  <span class="py-line">                <span class="py-comment"># Slightly prefer cached versions</span> </span>
<span class="py-lineno">337</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">==</span> <span id="link-95" class="py-name"><a title="zeroinstall.injector.model.network_full" class="py-name" href="#" onclick="doclink('link-95', 'network_full', 'Variable zeroinstall.injector.model.network_full=zeroinstall.injector.model-module.html#network_full'); return false;">network_full</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">338</span>  <span class="py-line">                        <span class="py-name">r</span> <span class="py-op">=</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span id="link-96" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_cached
zeroinstall.injector.policy.Policy.get_cached" class="py-name" href="#" onclick="doclink('link-96', 'get_cached', 'Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached,Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached'); return false;">get_cached</a></span></span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-97" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_cached
zeroinstall.injector.policy.Policy.get_cached" class="py-name" href="#" onclick="doclink('link-97', 'get_cached', 'Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached,Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached'); return false;">get_cached</a></span></span><span class="py-op">(</span><span class="py-name">b</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">339</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">r</span><span class="py-op">:</span> <span class="py-keyword">return</span> <span class="py-name">r</span> </span>
<span class="py-lineno">340</span>  <span class="py-line"> </span>
<span class="py-lineno">341</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">cmp</span><span class="py-op">(</span><span class="py-name">a</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">,</span> <span class="py-name">b</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">342</span>  <span class="py-line">         </span>
<a name="Policy.usable_feeds"></a><div id="Policy.usable_feeds-def"><span class="py-lineno">343</span> <a class="py-toggle" href="#" id="Policy.usable_feeds-toggle" onclick="toggle('Policy.usable_feeds'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#usable_feeds">usable_feeds</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">iface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.usable_feeds-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.usable_feeds-expanded"><span class="py-lineno">344</span>  <span class="py-line">                <span class="py-docstring">"""Generator for C{iface.feeds} that are valid for our architecture.</span> </span>
<span class="py-lineno">345</span>  <span class="py-line"><span class="py-docstring">                @rtype: generator</span> </span>
<span class="py-lineno">346</span>  <span class="py-line"><span class="py-docstring">                @see: L{arch}"""</span> </span>
<span class="py-lineno">347</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">src</span> <span class="py-keyword">and</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">uri</span> <span class="py-op">==</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root</span><span class="py-op">:</span> </span>
<span class="py-lineno">348</span>  <span class="py-line">                        <span class="py-comment"># Note: when feeds are recursive, we'll need a better test for root here</span> </span>
<span class="py-lineno">349</span>  <span class="py-line"><span class="py-comment"></span>                        <span id="link-98" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-98', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span> <span class="py-op">=</span> <span class="py-op">{</span><span class="py-string">'src'</span><span class="py-op">:</span> <span class="py-number">1</span><span class="py-op">}</span> </span>
<span class="py-lineno">350</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">351</span>  <span class="py-line">                        <span id="link-99" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-99', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span> <span class="py-op">=</span> <span id="link-100" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-100', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-101" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-101', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span> </span>
<span class="py-lineno">352</span>  <span class="py-line">                         </span>
<span class="py-lineno">353</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">f</span> <span class="py-keyword">in</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">feeds</span><span class="py-op">:</span> </span>
<span class="py-lineno">354</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">f</span><span class="py-op">.</span><span class="py-name">os</span> <span class="py-keyword">in</span> <span id="link-102" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-102', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-103" class="py-name"><a title="zeroinstall.injector.arch.os_ranks" class="py-name" href="#" onclick="doclink('link-103', 'os_ranks', 'Variable zeroinstall.injector.arch.os_ranks=zeroinstall.injector.arch-module.html#os_ranks'); return false;">os_ranks</a></span></span> <span class="py-keyword">and</span> <span class="py-name">f</span><span class="py-op">.</span><span class="py-name">machine</span> <span class="py-keyword">in</span> <span id="link-104" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-104', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">355</span>  <span class="py-line">                                <span class="py-keyword">yield</span> <span class="py-name">f</span> </span>
<span class="py-lineno">356</span>  <span class="py-line">                        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">357</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Skipping '%s'; unsupported architecture %s-%s"</span><span class="py-op">,</span> </span>
<span class="py-lineno">358</span>  <span class="py-line">                                        <span class="py-name">f</span><span class="py-op">,</span> <span class="py-name">f</span><span class="py-op">.</span><span class="py-name">os</span><span class="py-op">,</span> <span class="py-name">f</span><span class="py-op">.</span><span class="py-name">machine</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">359</span>  <span class="py-line">         </span>
<a name="Policy.get_ranked_implementations"></a><div id="Policy.get_ranked_implementations-def"><span class="py-lineno">360</span> <a class="py-toggle" href="#" id="Policy.get_ranked_implementations-toggle" onclick="toggle('Policy.get_ranked_implementations'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_ranked_implementations">get_ranked_implementations</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">iface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_ranked_implementations-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_ranked_implementations-expanded"><span class="py-lineno">361</span>  <span class="py-line">                <span class="py-docstring">"""Get all implementations from all feeds, in order.</span> </span>
<span class="py-lineno">362</span>  <span class="py-line"><span class="py-docstring">                @type iface: Interface</span> </span>
<span class="py-lineno">363</span>  <span class="py-line"><span class="py-docstring">                @return: a sorted list of implementations.</span> </span>
<span class="py-lineno">364</span>  <span class="py-line"><span class="py-docstring">                @rtype: [model.Implementation]"""</span> </span>
<span class="py-lineno">365</span>  <span class="py-line">                <span class="py-name">impls</span> <span class="py-op">=</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">.</span><span class="py-name">values</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">366</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">f</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-105" class="py-name"><a title="zeroinstall.injector.policy.Policy.usable_feeds
zeroinstall.injector.policy.Policy.usable_feeds" class="py-name" href="#" onclick="doclink('link-105', 'usable_feeds', 'Method zeroinstall.injector.policy.Policy.usable_feeds()=zeroinstall.injector.policy.Policy-class.html#usable_feeds,Method zeroinstall.injector.policy.Policy.usable_feeds()=zeroinstall.injector.policy.Policy-class.html#usable_feeds'); return false;">usable_feeds</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">367</span>  <span class="py-line">                        <span class="py-name">feed_iface</span> <span class="py-op">=</span> <span id="link-106" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-106', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-107" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-107', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">f</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">368</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">:</span> </span>
<span class="py-lineno">369</span>  <span class="py-line">                                <span class="py-name">impls</span><span class="py-op">.</span><span class="py-name">extend</span><span class="py-op">(</span><span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">.</span><span class="py-name">values</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">370</span>  <span class="py-line">                <span class="py-name">impls</span><span class="py-op">.</span><span class="py-name">sort</span><span class="py-op">(</span><span class="py-keyword">lambda</span> <span class="py-name">a</span><span class="py-op">,</span> <span class="py-name">b</span><span class="py-op">:</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-108" class="py-name"><a title="zeroinstall.injector.policy.Policy.compare
zeroinstall.injector.policy.Policy.compare" class="py-name" href="#" onclick="doclink('link-108', 'compare', 'Method zeroinstall.injector.policy.Policy.compare()=zeroinstall.injector.policy.Policy-class.html#compare,Method zeroinstall.injector.policy.Policy.compare()=zeroinstall.injector.policy.Policy-class.html#compare'); return false;">compare</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">a</span><span class="py-op">,</span> <span class="py-name">b</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">371</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">impls</span> </span>
</div><span class="py-lineno">372</span>  <span class="py-line">         </span>
<a name="Policy.is_unusable"></a><div id="Policy.is_unusable-def"><span class="py-lineno">373</span> <a class="py-toggle" href="#" id="Policy.is_unusable-toggle" onclick="toggle('Policy.is_unusable'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#is_unusable">is_unusable</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">impl</span><span class="py-op">,</span> <span class="py-param">restrictions</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.is_unusable-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.is_unusable-expanded"><span class="py-lineno">374</span>  <span class="py-line">                <span class="py-docstring">"""@return: whether this implementation is unusable.</span> </span>
<span class="py-lineno">375</span>  <span class="py-line"><span class="py-docstring">                @rtype: bool"""</span> </span>
<span class="py-lineno">376</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-109" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_unusable_reason
zeroinstall.injector.policy.Policy.get_unusable_reason" class="py-name" href="#" onclick="doclink('link-109', 'get_unusable_reason', 'Method zeroinstall.injector.policy.Policy.get_unusable_reason()=zeroinstall.injector.policy.Policy-class.html#get_unusable_reason,Method zeroinstall.injector.policy.Policy.get_unusable_reason()=zeroinstall.injector.policy.Policy-class.html#get_unusable_reason'); return false;">get_unusable_reason</a></span></span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">,</span> <span class="py-name">restrictions</span><span class="py-op">)</span> <span class="py-op">!=</span> <span class="py-name">None</span> </span>
</div><span class="py-lineno">377</span>  <span class="py-line"> </span>
<a name="Policy.get_unusable_reason"></a><div id="Policy.get_unusable_reason-def"><span class="py-lineno">378</span> <a class="py-toggle" href="#" id="Policy.get_unusable_reason-toggle" onclick="toggle('Policy.get_unusable_reason'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_unusable_reason">get_unusable_reason</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">impl</span><span class="py-op">,</span> <span class="py-param">restrictions</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_unusable_reason-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_unusable_reason-expanded"><span class="py-lineno">379</span>  <span class="py-line">                <span class="py-docstring">"""</span> </span>
<span class="py-lineno">380</span>  <span class="py-line"><span class="py-docstring">                @param impl: Implementation to test.</span> </span>
<span class="py-lineno">381</span>  <span class="py-line"><span class="py-docstring">                @type restrictions: [L{model.Restriction}]</span> </span>
<span class="py-lineno">382</span>  <span class="py-line"><span class="py-docstring">                @return: The reason why this impl is unusable, or None if it's OK.</span> </span>
<span class="py-lineno">383</span>  <span class="py-line"><span class="py-docstring">                @rtype: str</span> </span>
<span class="py-lineno">384</span>  <span class="py-line"><span class="py-docstring">                @note: The restrictions are for the interface being requested, not the interface</span> </span>
<span class="py-lineno">385</span>  <span class="py-line"><span class="py-docstring">                of the implementation; they may be different when feeds are being used."""</span> </span>
<span class="py-lineno">386</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">r</span> <span class="py-keyword">in</span> <span class="py-name">restrictions</span><span class="py-op">:</span> </span>
<span class="py-lineno">387</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">r</span><span class="py-op">.</span><span id="link-110" class="py-name"><a title="zeroinstall.injector.model.Restriction.meets_restriction" class="py-name" href="#" onclick="doclink('link-110', 'meets_restriction', 'Method zeroinstall.injector.model.Restriction.meets_restriction()=zeroinstall.injector.model.Restriction-class.html#meets_restriction'); return false;">meets_restriction</a></span></span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">388</span>  <span class="py-line">                                <span class="py-keyword">return</span> <span class="py-string">"Incompatible with another selected implementation"</span> </span>
<span class="py-lineno">389</span>  <span class="py-line">                <span class="py-name">stability</span> <span class="py-op">=</span> <span class="py-name">impl</span><span class="py-op">.</span><span id="link-111" class="py-name"><a title="zeroinstall.injector.model.Implementation.get_stability" class="py-name" href="#" onclick="doclink('link-111', 'get_stability', 'Method zeroinstall.injector.model.Implementation.get_stability()=zeroinstall.injector.model.Implementation-class.html#get_stability'); return false;">get_stability</a></span></span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno">390</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">stability</span> <span class="py-op">&lt;=</span> <span id="link-112" class="py-name"><a title="zeroinstall.injector.model.buggy" class="py-name" href="#" onclick="doclink('link-112', 'buggy', 'Variable zeroinstall.injector.model.buggy=zeroinstall.injector.model-module.html#buggy'); return false;">buggy</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">391</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">stability</span><span class="py-op">.</span><span class="py-name">name</span> </span>
<span class="py-lineno">392</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">==</span> <span id="link-113" class="py-name"><a title="zeroinstall.injector.model.network_offline" class="py-name" href="#" onclick="doclink('link-113', 'network_offline', 'Variable zeroinstall.injector.model.network_offline=zeroinstall.injector.model-module.html#network_offline'); return false;">network_offline</a></span></span> <span class="py-keyword">and</span> <span class="py-keyword">not</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-114" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_cached
zeroinstall.injector.policy.Policy.get_cached" class="py-name" href="#" onclick="doclink('link-114', 'get_cached', 'Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached,Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached'); return false;">get_cached</a></span></span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">393</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-string">"Not cached and we are off-line"</span> </span>
<span class="py-lineno">394</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">os</span> <span class="py-keyword">not</span> <span class="py-keyword">in</span> <span id="link-115" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-115', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-116" class="py-name"><a title="zeroinstall.injector.arch.os_ranks" class="py-name" href="#" onclick="doclink('link-116', 'os_ranks', 'Variable zeroinstall.injector.arch.os_ranks=zeroinstall.injector.arch-module.html#os_ranks'); return false;">os_ranks</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">395</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-string">"Unsupported OS"</span> </span>
<span class="py-lineno">396</span>  <span class="py-line">                <span class="py-comment"># When looking for source code, we need to known if we're</span> </span>
<span class="py-lineno">397</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># looking at an implementation of the root interface, even if</span> </span>
<span class="py-lineno">398</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-comment"># it's from a feed, hence the sneaky restrictions identity check.</span> </span>
<span class="py-lineno">399</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">src</span> <span class="py-keyword">and</span> <span class="py-name">restrictions</span> <span class="py-keyword">is</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">root_restrictions</span><span class="py-op">:</span> </span>
<span class="py-lineno">400</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">machine</span> <span class="py-op">!=</span> <span class="py-string">'src'</span><span class="py-op">:</span> </span>
<span class="py-lineno">401</span>  <span class="py-line">                                <span class="py-keyword">return</span> <span class="py-string">"Not source code"</span> </span>
<span class="py-lineno">402</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">403</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">machine</span> <span class="py-keyword">not</span> <span class="py-keyword">in</span> <span id="link-117" class="py-name"><a title="zeroinstall.injector.arch
zeroinstall.injector.model.Feed.arch
zeroinstall.injector.model.Implementation.arch" class="py-name" href="#" onclick="doclink('link-117', 'arch', 'Module zeroinstall.injector.arch=zeroinstall.injector.arch-module.html,Variable zeroinstall.injector.model.Feed.arch=zeroinstall.injector.model.Feed-class.html#arch,Variable zeroinstall.injector.model.Implementation.arch=zeroinstall.injector.model.Implementation-class.html#arch'); return false;">arch</a></span></span><span class="py-op">.</span><span id="link-118" class="py-name"><a title="zeroinstall.injector.arch.machine_ranks" class="py-name" href="#" onclick="doclink('link-118', 'machine_ranks', 'Variable zeroinstall.injector.arch.machine_ranks=zeroinstall.injector.arch-module.html#machine_ranks'); return false;">machine_ranks</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">404</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">machine</span> <span class="py-op">==</span> <span class="py-string">'src'</span><span class="py-op">:</span> </span>
<span class="py-lineno">405</span>  <span class="py-line">                                        <span class="py-keyword">return</span> <span class="py-string">"Source code"</span> </span>
<span class="py-lineno">406</span>  <span class="py-line">                                <span class="py-keyword">return</span> <span class="py-string">"Unsupported machine type"</span> </span>
<span class="py-lineno">407</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">None</span> </span>
</div><span class="py-lineno">408</span>  <span class="py-line">         </span>
<a name="Policy.get_interface"></a><div id="Policy.get_interface-def"><span class="py-lineno">409</span> <a class="py-toggle" href="#" id="Policy.get_interface-toggle" onclick="toggle('Policy.get_interface'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_interface">get_interface</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">uri</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_interface-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_interface-expanded"><span class="py-lineno">410</span>  <span class="py-line">                <span class="py-docstring">"""Get an interface from the L{iface_cache}. If it is missing start a new download.</span> </span>
<span class="py-lineno">411</span>  <span class="py-line"><span class="py-docstring">                If it is present but stale, add it to L{stale_feeds}. This should only be called</span> </span>
<span class="py-lineno">412</span>  <span class="py-line"><span class="py-docstring">                from L{recalculate}.</span> </span>
<span class="py-lineno">413</span>  <span class="py-line"><span class="py-docstring">                @see: iface_cache.iface_cache.get_interface</span> </span>
<span class="py-lineno">414</span>  <span class="py-line"><span class="py-docstring">                @rtype: L{model.Interface}"""</span> </span>
<span class="py-lineno">415</span>  <span class="py-line">                <span class="py-name">iface</span> <span class="py-op">=</span> <span id="link-119" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-119', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-120" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-120', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">416</span>  <span class="py-line"> </span>
<span class="py-lineno">417</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">uri</span> <span class="py-keyword">in</span> <span id="link-121" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-121', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span class="py-name">pending</span><span class="py-op">:</span> </span>
<span class="py-lineno">418</span>  <span class="py-line">                        <span class="py-comment"># Don't start another download while one is pending</span> </span>
<span class="py-lineno">419</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-comment"># TODO: unless the pending version is very old</span> </span>
<span class="py-lineno">420</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-keyword">return</span> <span class="py-name">iface</span> </span>
<span class="py-lineno">421</span>  <span class="py-line"> </span>
<span class="py-lineno">422</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">last_modified</span> <span class="py-keyword">is</span> <span class="py-name">None</span><span class="py-op">:</span> </span>
<span class="py-lineno">423</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">!=</span> <span id="link-122" class="py-name"><a title="zeroinstall.injector.model.network_offline" class="py-name" href="#" onclick="doclink('link-122', 'network_offline', 'Variable zeroinstall.injector.model.network_offline=zeroinstall.injector.model-module.html#network_offline'); return false;">network_offline</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">424</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Interface not cached and not off-line. Downloading..."</span><span class="py-op">)</span> </span>
<span class="py-lineno">425</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span id="link-123" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download
zeroinstall.injector.policy.Policy.begin_iface_download" class="py-name" href="#" onclick="doclink('link-123', 'begin_iface_download', 'Method zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download()=zeroinstall.injector.autopolicy.AutoPolicy-class.html#begin_iface_download,Method zeroinstall.injector.policy.Policy.begin_iface_download()=zeroinstall.injector.policy.Policy-class.html#begin_iface_download'); return false;">begin_iface_download</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">426</span>  <span class="py-line">                        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">427</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">_warned_offline</span><span class="py-op">:</span> </span>
<span class="py-lineno">428</span>  <span class="py-line">                                        <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Nothing known about interface, but we are off-line."</span><span class="py-op">)</span> </span>
<span class="py-lineno">429</span>  <span class="py-line">                                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">430</span>  <span class="py-line">                                        <span class="py-keyword">if</span> <span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">feeds</span><span class="py-op">:</span> </span>
<span class="py-lineno">431</span>  <span class="py-line">                                                <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"Nothing known about interface '%s' and off-line. Trying feeds only."</span><span class="py-op">,</span> <span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">432</span>  <span class="py-line">                                        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">433</span>  <span class="py-line">                                                <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Nothing known about interface '%s', but we are in off-line mode "</span> </span>
<span class="py-lineno">434</span>  <span class="py-line">                                                        <span class="py-string">"(so not fetching)."</span><span class="py-op">,</span> <span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">435</span>  <span class="py-line">                                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">_warned_offline</span> <span class="py-op">=</span> <span class="py-name">True</span> </span>
<span class="py-lineno">436</span>  <span class="py-line">                <span class="py-keyword">elif</span> <span class="py-keyword">not</span> <span class="py-name">uri</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'/'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">437</span>  <span class="py-line">                        <span class="py-name">staleness</span> <span class="py-op">=</span> <span class="py-name">time</span><span class="py-op">.</span><span class="py-name">time</span><span class="py-op">(</span><span class="py-op">)</span> <span class="py-op">-</span> <span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">.</span><span class="py-name">last_checked</span> <span class="py-keyword">or</span> <span class="py-number">0</span><span class="py-op">)</span> </span>
<span class="py-lineno">438</span>  <span class="py-line">                        <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Staleness for %s is %.2f hours"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">staleness</span> <span class="py-op">/</span> <span class="py-number">3600.0</span><span class="py-op">)</span> </span>
<span class="py-lineno">439</span>  <span class="py-line"> </span>
<span class="py-lineno">440</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">freshness</span> <span class="py-op">&gt;</span> <span class="py-number">0</span> <span class="py-keyword">and</span> <span class="py-name">staleness</span> <span class="py-op">&gt;</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">freshness</span><span class="py-op">:</span> </span>
<span class="py-lineno">441</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Adding %s to stale set"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">442</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">stale_feeds</span><span class="py-op">.</span><span class="py-name">add</span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">443</span>  <span class="py-line">                <span class="py-comment">#else: debug("Local interface, so not checking staleness.")</span> </span>
<span class="py-lineno">444</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno">445</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">iface</span> </span>
</div><span class="py-lineno">446</span>  <span class="py-line">         </span>
<a name="Policy.begin_iface_download"></a><div id="Policy.begin_iface_download-def"><span class="py-lineno">447</span> <a class="py-toggle" href="#" id="Policy.begin_iface_download-toggle" onclick="toggle('Policy.begin_iface_download'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#begin_iface_download">begin_iface_download</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">interface</span><span class="py-op">,</span> <span class="py-param">force</span> <span class="py-op">=</span> <span class="py-name">False</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.begin_iface_download-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.begin_iface_download-expanded"><span class="py-lineno">448</span>  <span class="py-line">                <span class="py-docstring">"""Start downloading the interface, and add a callback to process it when</span> </span>
<span class="py-lineno">449</span>  <span class="py-line"><span class="py-docstring">                done. If it is already being downloaded, do nothing."""</span> </span>
<span class="py-lineno">450</span>  <span class="py-line">                 </span>
<span class="py-lineno">451</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"begin_iface_download %s (force = %d)"</span><span class="py-op">,</span> <span class="py-name">interface</span><span class="py-op">,</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">452</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'/'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">453</span>  <span class="py-line">                        <span class="py-keyword">return</span> </span>
<span class="py-lineno">454</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"Need to download"</span><span class="py-op">)</span> </span>
<span class="py-lineno">455</span>  <span class="py-line">                <span class="py-name">dl</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-124" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-124', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span><span class="py-op">.</span><span id="link-125" class="py-name"><a title="zeroinstall.injector.handler.Handler.get_download
zeroinstall.injector.handler.Handler.get_download" class="py-name" href="#" onclick="doclink('link-125', 'get_download', 'Method zeroinstall.injector.handler.Handler.get_download()=zeroinstall.injector.handler.Handler-class.html#get_download,Method zeroinstall.injector.handler.Handler.get_download()=zeroinstall.injector.handler.Handler-class.html#get_download'); return false;">get_download</a></span></span><span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">,</span> <span class="py-name">force</span> <span class="py-op">=</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">456</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">dl</span><span class="py-op">.</span><span class="py-name">on_success</span><span class="py-op">:</span> </span>
<span class="py-lineno">457</span>  <span class="py-line">                        <span class="py-comment"># Possibly we should handle this better, but it's unlikely anyone will need</span> </span>
<span class="py-lineno">458</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-comment"># to use an interface as an icon or implementation as well, and some of the code</span> </span>
<span class="py-lineno">459</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-comment"># assumes it's OK keep asking for the same interface to be downloaded.</span> </span>
<span class="py-lineno">460</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"Already have a handler for %s; not adding another"</span><span class="py-op">,</span> <span class="py-name">interface</span><span class="py-op">)</span> </span>
<span class="py-lineno">461</span>  <span class="py-line">                        <span class="py-keyword">return</span> </span>
<span class="py-lineno">462</span>  <span class="py-line"> </span>
<span class="py-lineno">463</span>  <span class="py-line">                <span class="py-keyword">def</span> <span class="py-def-name">feed_downloaded</span><span class="py-op">(</span><span class="py-param">stream</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">464</span>  <span class="py-line">                        <span class="py-name">pending</span> <span class="py-op">=</span> <span id="link-126" class="py-name"><a title="zeroinstall.injector.iface_cache.PendingFeed" class="py-name" href="#" onclick="doclink('link-126', 'PendingFeed', 'Class zeroinstall.injector.iface_cache.PendingFeed=zeroinstall.injector.iface_cache.PendingFeed-class.html'); return false;">PendingFeed</a></span></span><span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">,</span> <span class="py-name">stream</span><span class="py-op">)</span> </span>
<span class="py-lineno">465</span>  <span class="py-line">                        <span id="link-127" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-127', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-128" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.add_pending" class="py-name" href="#" onclick="doclink('link-128', 'add_pending', 'Method zeroinstall.injector.iface_cache.IfaceCache.add_pending()=zeroinstall.injector.iface_cache.IfaceCache-class.html#add_pending'); return false;">add_pending</a></span></span><span class="py-op">(</span><span class="py-name">pending</span><span class="py-op">)</span> </span>
<span class="py-lineno">466</span>  <span class="py-line">                        <span class="py-comment"># This will trigger any required confirmations</span> </span>
<span class="py-lineno">467</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-129" class="py-name"><a title="zeroinstall.injector.policy.Policy.process_pending
zeroinstall.injector.policy.Policy.process_pending" class="py-name" href="#" onclick="doclink('link-129', 'process_pending', 'Method zeroinstall.injector.policy.Policy.process_pending()=zeroinstall.injector.policy.Policy-class.html#process_pending,Method zeroinstall.injector.policy.Policy.process_pending()=zeroinstall.injector.policy.Policy-class.html#process_pending'); return false;">process_pending</a></span></span><span class="py-op">(</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">468</span>  <span class="py-line"> </span>
<span class="py-lineno">469</span>  <span class="py-line">                <span class="py-name">dl</span><span class="py-op">.</span><span class="py-name">on_success</span><span class="py-op">.</span><span class="py-name">append</span><span class="py-op">(</span><span class="py-name">feed_downloaded</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">470</span>  <span class="py-line">         </span>
<a name="Policy.begin_impl_download"></a><div id="Policy.begin_impl_download-def"><span class="py-lineno">471</span> <a class="py-toggle" href="#" id="Policy.begin_impl_download-toggle" onclick="toggle('Policy.begin_impl_download'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#begin_impl_download">begin_impl_download</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">impl</span><span class="py-op">,</span> <span class="py-param">retrieval_method</span><span class="py-op">,</span> <span class="py-param">force</span> <span class="py-op">=</span> <span class="py-name">False</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.begin_impl_download-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.begin_impl_download-expanded"><span class="py-lineno">472</span>  <span class="py-line">                <span class="py-docstring">"""Start fetching impl, using retrieval_method. Each download started</span> </span>
<span class="py-lineno">473</span>  <span class="py-line"><span class="py-docstring">                will call monitor_download."""</span> </span>
<span class="py-lineno">474</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">impl</span> </span>
<span class="py-lineno">475</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">retrieval_method</span> </span>
<span class="py-lineno">476</span>  <span class="py-line"> </span>
<span class="py-lineno">477</span>  <span class="py-line">                <span class="py-keyword">from</span> <span id="link-130" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-130', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span><span class="py-op">.</span><span id="link-131" class="py-name"><a title="zeroinstall.zerostore" class="py-name" href="#" onclick="doclink('link-131', 'zerostore', 'Package zeroinstall.zerostore=zeroinstall.zerostore-module.html'); return false;">zerostore</a></span></span> <span class="py-keyword">import</span> <span id="link-132" class="py-name"><a title="zeroinstall.zerostore.manifest" class="py-name" href="#" onclick="doclink('link-132', 'manifest', 'Module zeroinstall.zerostore.manifest=zeroinstall.zerostore.manifest-module.html'); return false;">manifest</a></span></span> </span>
<span class="py-lineno">478</span>  <span class="py-line">                <span class="py-name">alg</span> <span class="py-op">=</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">.</span><span class="py-name">split</span><span class="py-op">(</span><span class="py-string">'='</span><span class="py-op">,</span> <span class="py-number">1</span><span class="py-op">)</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> </span>
<span class="py-lineno">479</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">alg</span> <span class="py-keyword">not</span> <span class="py-keyword">in</span> <span id="link-133" class="py-name"><a title="zeroinstall.zerostore.manifest" class="py-name" href="#" onclick="doclink('link-133', 'manifest', 'Module zeroinstall.zerostore.manifest=zeroinstall.zerostore.manifest-module.html'); return false;">manifest</a></span></span><span class="py-op">.</span><span id="link-134" class="py-name"><a title="zeroinstall.zerostore.manifest.algorithms" class="py-name" href="#" onclick="doclink('link-134', 'algorithms', 'Variable zeroinstall.zerostore.manifest.algorithms=zeroinstall.zerostore.manifest-module.html#algorithms'); return false;">algorithms</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">480</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span id="link-135" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-135', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">"Unknown digest algorithm '%s' for '%s' version %s"</span> <span class="py-op">%</span> </span>
<span class="py-lineno">481</span>  <span class="py-line">                                        <span class="py-op">(</span><span class="py-name">alg</span><span class="py-op">,</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">interface</span><span class="py-op">.</span><span id="link-136" class="py-name"><a title="zeroinstall.injector.model.Interface.get_name" class="py-name" href="#" onclick="doclink('link-136', 'get_name', 'Method zeroinstall.injector.model.Interface.get_name()=zeroinstall.injector.model.Interface-class.html#get_name'); return false;">get_name</a></span></span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">impl</span><span class="py-op">.</span><span id="link-137" class="py-name"><a title="zeroinstall.injector.model.Implementation.get_version" class="py-name" href="#" onclick="doclink('link-137', 'get_version', 'Method zeroinstall.injector.model.Implementation.get_version()=zeroinstall.injector.model.Implementation-class.html#get_version'); return false;">get_version</a></span></span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">482</span>  <span class="py-line"> </span>
<span class="py-lineno">483</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">isinstance</span><span class="py-op">(</span><span class="py-name">retrieval_method</span><span class="py-op">,</span> <span id="link-138" class="py-name"><a title="zeroinstall.injector.model.DownloadSource" class="py-name" href="#" onclick="doclink('link-138', 'DownloadSource', 'Class zeroinstall.injector.model.DownloadSource=zeroinstall.injector.model.DownloadSource-class.html'); return false;">DownloadSource</a></span></span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">484</span>  <span class="py-line">                        <span class="py-keyword">def</span> <span class="py-def-name">archive_ready</span><span class="py-op">(</span><span class="py-param">stream</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">485</span>  <span class="py-line">                                <span id="link-139" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-139', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-140" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.add_to_cache
zeroinstall.injector.policy.Policy.add_to_cache
zeroinstall.injector.policy.Policy.add_to_cache" class="py-name" href="#" onclick="doclink('link-140', 'add_to_cache', 'Method zeroinstall.injector.iface_cache.IfaceCache.add_to_cache()=zeroinstall.injector.iface_cache.IfaceCache-class.html#add_to_cache,Method zeroinstall.injector.policy.Policy.add_to_cache()=zeroinstall.injector.policy.Policy-class.html#add_to_cache,Method zeroinstall.injector.policy.Policy.add_to_cache()=zeroinstall.injector.policy.Policy-class.html#add_to_cache'); return false;">add_to_cache</a></span></span><span class="py-op">(</span><span class="py-name">retrieval_method</span><span class="py-op">,</span> <span class="py-name">stream</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">486</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-141" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.begin_archive_download
zeroinstall.injector.policy.Policy.begin_archive_download" class="py-name" href="#" onclick="doclink('link-141', 'begin_archive_download', 'Method zeroinstall.injector.autopolicy.AutoPolicy.begin_archive_download()=zeroinstall.injector.autopolicy.AutoPolicy-class.html#begin_archive_download,Method zeroinstall.injector.policy.Policy.begin_archive_download()=zeroinstall.injector.policy.Policy-class.html#begin_archive_download'); return false;">begin_archive_download</a></span></span><span class="py-op">(</span><span class="py-name">retrieval_method</span><span class="py-op">,</span> <span class="py-name">success_callback</span> <span class="py-op">=</span> <span class="py-name">archive_ready</span><span class="py-op">,</span> <span class="py-name">force</span> <span class="py-op">=</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">487</span>  <span class="py-line">                <span class="py-keyword">elif</span> <span class="py-name">isinstance</span><span class="py-op">(</span><span class="py-name">retrieval_method</span><span class="py-op">,</span> <span id="link-142" class="py-name"><a title="zeroinstall.injector.model.Recipe" class="py-name" href="#" onclick="doclink('link-142', 'Recipe', 'Class zeroinstall.injector.model.Recipe=zeroinstall.injector.model.Recipe-class.html'); return false;">Recipe</a></span></span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">488</span>  <span class="py-line">                        <span class="py-name">_Cook</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">,</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">,</span> <span class="py-name">retrieval_method</span><span class="py-op">)</span> </span>
<span class="py-lineno">489</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">490</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span class="py-name">Exception</span><span class="py-op">(</span><span class="py-string">"Unknown download type for '%s'"</span> <span class="py-op">%</span> <span class="py-name">retrieval_method</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">491</span>  <span class="py-line"> </span>
<a name="Policy.begin_archive_download"></a><div id="Policy.begin_archive_download-def"><span class="py-lineno">492</span> <a class="py-toggle" href="#" id="Policy.begin_archive_download-toggle" onclick="toggle('Policy.begin_archive_download'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#begin_archive_download">begin_archive_download</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">download_source</span><span class="py-op">,</span> <span class="py-param">success_callback</span><span class="py-op">,</span> <span class="py-param">force</span> <span class="py-op">=</span> <span class="py-name">False</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.begin_archive_download-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.begin_archive_download-expanded"><span class="py-lineno">493</span>  <span class="py-line">                <span class="py-docstring">"""Start fetching an archive. You should normally call L{begin_impl_download}</span> </span>
<span class="py-lineno">494</span>  <span class="py-line"><span class="py-docstring">                instead, since it handles other kinds of retrieval method too."""</span> </span>
<span class="py-lineno">495</span>  <span class="py-line">                <span class="py-keyword">from</span> <span id="link-143" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-143', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span><span class="py-op">.</span><span id="link-144" class="py-name"><a title="zeroinstall.zerostore" class="py-name" href="#" onclick="doclink('link-144', 'zerostore', 'Package zeroinstall.zerostore=zeroinstall.zerostore-module.html'); return false;">zerostore</a></span></span> <span class="py-keyword">import</span> <span id="link-145" class="py-name"><a title="zeroinstall.zerostore.unpack" class="py-name" href="#" onclick="doclink('link-145', 'unpack', 'Module zeroinstall.zerostore.unpack=zeroinstall.zerostore.unpack-module.html'); return false;">unpack</a></span></span> </span>
<span class="py-lineno">496</span>  <span class="py-line">                <span class="py-name">mime_type</span> <span class="py-op">=</span> <span class="py-name">download_source</span><span class="py-op">.</span><span class="py-name">type</span> </span>
<span class="py-lineno">497</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">mime_type</span><span class="py-op">:</span> </span>
<span class="py-lineno">498</span>  <span class="py-line">                        <span class="py-name">mime_type</span> <span class="py-op">=</span> <span id="link-146" class="py-name"><a title="zeroinstall.zerostore.unpack" class="py-name" href="#" onclick="doclink('link-146', 'unpack', 'Module zeroinstall.zerostore.unpack=zeroinstall.zerostore.unpack-module.html'); return false;">unpack</a></span></span><span class="py-op">.</span><span id="link-147" class="py-name"><a title="zeroinstall.zerostore.unpack.type_from_url" class="py-name" href="#" onclick="doclink('link-147', 'type_from_url', 'Function zeroinstall.zerostore.unpack.type_from_url()=zeroinstall.zerostore.unpack-module.html#type_from_url'); return false;">type_from_url</a></span></span><span class="py-op">(</span><span class="py-name">download_source</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span> </span>
<span class="py-lineno">499</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">mime_type</span><span class="py-op">:</span> </span>
<span class="py-lineno">500</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span id="link-148" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-148', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">"No 'type' attribute on archive, and I can't guess from the name (%s)"</span> <span class="py-op">%</span> <span class="py-name">download_source</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span> </span>
<span class="py-lineno">501</span>  <span class="py-line">                <span id="link-149" class="py-name"><a title="zeroinstall.zerostore.unpack" class="py-name" href="#" onclick="doclink('link-149', 'unpack', 'Module zeroinstall.zerostore.unpack=zeroinstall.zerostore.unpack-module.html'); return false;">unpack</a></span></span><span class="py-op">.</span><span id="link-150" class="py-name"><a title="zeroinstall.zerostore.unpack.check_type_ok" class="py-name" href="#" onclick="doclink('link-150', 'check_type_ok', 'Function zeroinstall.zerostore.unpack.check_type_ok()=zeroinstall.zerostore.unpack-module.html#check_type_ok'); return false;">check_type_ok</a></span></span><span class="py-op">(</span><span class="py-name">mime_type</span><span class="py-op">)</span> </span>
<span class="py-lineno">502</span>  <span class="py-line">                <span class="py-name">dl</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-151" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-151', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span><span class="py-op">.</span><span id="link-152" class="py-name"><a title="zeroinstall.injector.handler.Handler.get_download
zeroinstall.injector.handler.Handler.get_download" class="py-name" href="#" onclick="doclink('link-152', 'get_download', 'Method zeroinstall.injector.handler.Handler.get_download()=zeroinstall.injector.handler.Handler-class.html#get_download,Method zeroinstall.injector.handler.Handler.get_download()=zeroinstall.injector.handler.Handler-class.html#get_download'); return false;">get_download</a></span></span><span class="py-op">(</span><span class="py-name">download_source</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">,</span> <span class="py-name">force</span> <span class="py-op">=</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">503</span>  <span class="py-line">                <span class="py-name">dl</span><span class="py-op">.</span><span class="py-name">expected_size</span> <span class="py-op">=</span> <span class="py-name">download_source</span><span class="py-op">.</span><span id="link-153" class="py-name"><a title="zeroinstall.injector.model.Recipe.size" class="py-name" href="#" onclick="doclink('link-153', 'size', 'Variable zeroinstall.injector.model.Recipe.size=zeroinstall.injector.model.Recipe-class.html#size'); return false;">size</a></span></span> <span class="py-op">+</span> <span class="py-op">(</span><span class="py-name">download_source</span><span class="py-op">.</span><span class="py-name">start_offset</span> <span class="py-keyword">or</span> <span class="py-number">0</span><span class="py-op">)</span> </span>
<span class="py-lineno">504</span>  <span class="py-line">                <span class="py-name">dl</span><span class="py-op">.</span><span class="py-name">on_success</span><span class="py-op">.</span><span class="py-name">append</span><span class="py-op">(</span><span class="py-name">success_callback</span><span class="py-op">)</span> </span>
<span class="py-lineno">505</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">dl</span> </span>
</div><span class="py-lineno">506</span>  <span class="py-line">         </span>
<a name="Policy.begin_icon_download"></a><div id="Policy.begin_icon_download-def"><span class="py-lineno">507</span> <a class="py-toggle" href="#" id="Policy.begin_icon_download-toggle" onclick="toggle('Policy.begin_icon_download'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#begin_icon_download">begin_icon_download</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">interface</span><span class="py-op">,</span> <span class="py-param">force</span> <span class="py-op">=</span> <span class="py-name">False</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.begin_icon_download-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.begin_icon_download-expanded"><span class="py-lineno">508</span>  <span class="py-line">                <span class="py-docstring">"""Start downloading an icon for this interface. On success, add it to the</span> </span>
<span class="py-lineno">509</span>  <span class="py-line"><span class="py-docstring">                icon cache. If the interface has no icon, do nothing."""</span> </span>
<span class="py-lineno">510</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"begin_icon_download %s (force = %d)"</span><span class="py-op">,</span> <span class="py-name">interface</span><span class="py-op">,</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">511</span>  <span class="py-line"> </span>
<span class="py-lineno">512</span>  <span class="py-line">                <span class="py-comment"># Find a suitable icon to download</span> </span>
<span class="py-lineno">513</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">for</span> <span class="py-name">icon</span> <span class="py-keyword">in</span> <span class="py-name">interface</span><span class="py-op">.</span><span id="link-154" class="py-name"><a title="zeroinstall.injector.model.Interface.get_metadata" class="py-name" href="#" onclick="doclink('link-154', 'get_metadata', 'Method zeroinstall.injector.model.Interface.get_metadata()=zeroinstall.injector.model.Interface-class.html#get_metadata'); return false;">get_metadata</a></span></span><span class="py-op">(</span><span id="link-155" class="py-name"><a title="zeroinstall.injector.namespaces.XMLNS_IFACE" class="py-name" href="#" onclick="doclink('link-155', 'XMLNS_IFACE', 'Variable zeroinstall.injector.namespaces.XMLNS_IFACE=zeroinstall.injector.namespaces-module.html#XMLNS_IFACE'); return false;">XMLNS_IFACE</a></span></span><span class="py-op">,</span> <span class="py-string">'icon'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">514</span>  <span class="py-line">                        <span class="py-name">type</span> <span class="py-op">=</span> <span class="py-name">icon</span><span class="py-op">.</span><span id="link-156" class="py-name"><a title="zeroinstall.injector.qdom.Element.getAttribute" class="py-name" href="#" onclick="doclink('link-156', 'getAttribute', 'Method zeroinstall.injector.qdom.Element.getAttribute()=zeroinstall.injector.qdom.Element-class.html#getAttribute'); return false;">getAttribute</a></span></span><span class="py-op">(</span><span class="py-string">'type'</span><span class="py-op">)</span> </span>
<span class="py-lineno">515</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">type</span> <span class="py-op">!=</span> <span class="py-string">'image/png'</span><span class="py-op">:</span> </span>
<span class="py-lineno">516</span>  <span class="py-line">                                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">'Skipping non-PNG icon'</span><span class="py-op">)</span> </span>
<span class="py-lineno">517</span>  <span class="py-line">                                <span class="py-keyword">continue</span> </span>
<span class="py-lineno">518</span>  <span class="py-line">                        <span class="py-name">source</span> <span class="py-op">=</span> <span class="py-name">icon</span><span class="py-op">.</span><span id="link-157" class="py-name"><a title="zeroinstall.injector.qdom.Element.getAttribute" class="py-name" href="#" onclick="doclink('link-157', 'getAttribute', 'Method zeroinstall.injector.qdom.Element.getAttribute()=zeroinstall.injector.qdom.Element-class.html#getAttribute'); return false;">getAttribute</a></span></span><span class="py-op">(</span><span class="py-string">'href'</span><span class="py-op">)</span> </span>
<span class="py-lineno">519</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">source</span><span class="py-op">:</span> </span>
<span class="py-lineno">520</span>  <span class="py-line">                                <span class="py-keyword">break</span> </span>
<span class="py-lineno">521</span>  <span class="py-line">                        <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">'Missing "href" attribute on &lt;icon&gt; in %s'</span><span class="py-op">,</span> <span class="py-name">interface</span><span class="py-op">)</span> </span>
<span class="py-lineno">522</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">523</span>  <span class="py-line">                        <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">'No PNG icons found in %s'</span><span class="py-op">,</span> <span class="py-name">interface</span><span class="py-op">)</span> </span>
<span class="py-lineno">524</span>  <span class="py-line">                        <span class="py-keyword">return</span> </span>
<span class="py-lineno">525</span>  <span class="py-line"> </span>
<span class="py-lineno">526</span>  <span class="py-line">                <span class="py-name">dl</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-158" class="py-name"><a title="zeroinstall.injector.handler" class="py-name" href="#" onclick="doclink('link-158', 'handler', 'Module zeroinstall.injector.handler=zeroinstall.injector.handler-module.html'); return false;">handler</a></span></span><span class="py-op">.</span><span id="link-159" class="py-name"><a title="zeroinstall.injector.handler.Handler.get_download
zeroinstall.injector.handler.Handler.get_download" class="py-name" href="#" onclick="doclink('link-159', 'get_download', 'Method zeroinstall.injector.handler.Handler.get_download()=zeroinstall.injector.handler.Handler-class.html#get_download,Method zeroinstall.injector.handler.Handler.get_download()=zeroinstall.injector.handler.Handler-class.html#get_download'); return false;">get_download</a></span></span><span class="py-op">(</span><span class="py-name">source</span><span class="py-op">,</span> <span class="py-name">force</span> <span class="py-op">=</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">527</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">dl</span><span class="py-op">.</span><span class="py-name">on_success</span><span class="py-op">:</span> </span>
<span class="py-lineno">528</span>  <span class="py-line">                        <span class="py-comment"># Possibly we should handle this better, but it's unlikely anyone will need</span> </span>
<span class="py-lineno">529</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-comment"># to use an icon as an interface or implementation as well, and some of the code</span> </span>
<span class="py-lineno">530</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-comment"># may assume it's OK keep asking for the same icon to be downloaded.</span> </span>
<span class="py-lineno">531</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"Already have a handler for %s; not adding another"</span><span class="py-op">,</span> <span class="py-name">source</span><span class="py-op">)</span> </span>
<span class="py-lineno">532</span>  <span class="py-line">                        <span class="py-keyword">return</span> </span>
<span class="py-lineno">533</span>  <span class="py-line">                <span class="py-name">dl</span><span class="py-op">.</span><span class="py-name">on_success</span><span class="py-op">.</span><span class="py-name">append</span><span class="py-op">(</span><span class="py-keyword">lambda</span> <span class="py-name">stream</span><span class="py-op">:</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-160" class="py-name"><a title="zeroinstall.injector.policy.Policy.store_icon
zeroinstall.injector.policy.Policy.store_icon" class="py-name" href="#" onclick="doclink('link-160', 'store_icon', 'Method zeroinstall.injector.policy.Policy.store_icon()=zeroinstall.injector.policy.Policy-class.html#store_icon,Method zeroinstall.injector.policy.Policy.store_icon()=zeroinstall.injector.policy.Policy-class.html#store_icon'); return false;">store_icon</a></span></span><span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">,</span> <span class="py-name">stream</span><span class="py-op">)</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">534</span>  <span class="py-line"> </span>
<a name="Policy.store_icon"></a><div id="Policy.store_icon-def"><span class="py-lineno">535</span> <a class="py-toggle" href="#" id="Policy.store_icon-toggle" onclick="toggle('Policy.store_icon'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#store_icon">store_icon</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">interface</span><span class="py-op">,</span> <span class="py-param">stream</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.store_icon-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.store_icon-expanded"><span class="py-lineno">536</span>  <span class="py-line">                <span class="py-docstring">"""Called when an icon has been successfully downloaded.</span> </span>
<span class="py-lineno">537</span>  <span class="py-line"><span class="py-docstring">                Subclasses may wish to wrap this to repaint the display."""</span> </span>
<span class="py-lineno">538</span>  <span class="py-line">                <span class="py-keyword">from</span> <span id="link-161" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-161', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span><span class="py-op">.</span><span id="link-162" class="py-name"><a title="zeroinstall.injector" class="py-name" href="#" onclick="doclink('link-162', 'injector', 'Package zeroinstall.injector=zeroinstall.injector-module.html'); return false;">injector</a></span></span> <span class="py-keyword">import</span> <span id="link-163" class="py-name"><a title="zeroinstall.injector.basedir" class="py-name" href="#" onclick="doclink('link-163', 'basedir', 'Module zeroinstall.injector.basedir=zeroinstall.injector.basedir-module.html'); return false;">basedir</a></span></span> </span>
<span class="py-lineno">539</span>  <span class="py-line">                <span class="py-keyword">import</span> <span class="py-name">shutil</span> </span>
<span class="py-lineno">540</span>  <span class="py-line">                <span class="py-name">icons_cache</span> <span class="py-op">=</span> <span id="link-164" class="py-name"><a title="zeroinstall.injector.basedir" class="py-name" href="#" onclick="doclink('link-164', 'basedir', 'Module zeroinstall.injector.basedir=zeroinstall.injector.basedir-module.html'); return false;">basedir</a></span></span><span class="py-op">.</span><span id="link-165" class="py-name"><a title="zeroinstall.injector.basedir.save_cache_path" class="py-name" href="#" onclick="doclink('link-165', 'save_cache_path', 'Function zeroinstall.injector.basedir.save_cache_path()=zeroinstall.injector.basedir-module.html#save_cache_path'); return false;">save_cache_path</a></span></span><span class="py-op">(</span><span id="link-166" class="py-name"><a title="zeroinstall.injector.namespaces.config_site" class="py-name" href="#" onclick="doclink('link-166', 'config_site', 'Variable zeroinstall.injector.namespaces.config_site=zeroinstall.injector.namespaces-module.html#config_site'); return false;">config_site</a></span></span><span class="py-op">,</span> <span class="py-string">'interface_icons'</span><span class="py-op">)</span> </span>
<span class="py-lineno">541</span>  <span class="py-line">                <span class="py-name">icon_file</span> <span class="py-op">=</span> <span class="py-name">file</span><span class="py-op">(</span><span class="py-name">os</span><span class="py-op">.</span><span class="py-name">path</span><span class="py-op">.</span><span class="py-name">join</span><span class="py-op">(</span><span class="py-name">icons_cache</span><span class="py-op">,</span> <span id="link-167" class="py-name"><a title="zeroinstall.injector.model.escape" class="py-name" href="#" onclick="doclink('link-167', 'escape', 'Function zeroinstall.injector.model.escape()=zeroinstall.injector.model-module.html#escape'); return false;">escape</a></span></span><span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-string">'w'</span><span class="py-op">)</span> </span>
<span class="py-lineno">542</span>  <span class="py-line">                <span class="py-name">shutil</span><span class="py-op">.</span><span class="py-name">copyfileobj</span><span class="py-op">(</span><span class="py-name">stream</span><span class="py-op">,</span> <span class="py-name">icon_file</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">543</span>  <span class="py-line">         </span>
<a name="Policy.get_implementation_path"></a><div id="Policy.get_implementation_path-def"><span class="py-lineno">544</span> <a class="py-toggle" href="#" id="Policy.get_implementation_path-toggle" onclick="toggle('Policy.get_implementation_path'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_implementation_path">get_implementation_path</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">impl</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_implementation_path-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_implementation_path-expanded"><span class="py-lineno">545</span>  <span class="py-line">                <span class="py-docstring">"""Return the local path of impl.</span> </span>
<span class="py-lineno">546</span>  <span class="py-line"><span class="py-docstring">                @rtype: str</span> </span>
<span class="py-lineno">547</span>  <span class="py-line"><span class="py-docstring">                @raise zeroinstall.zerostore.NotStored: if it needs to be added to the cache first."""</span> </span>
<span class="py-lineno">548</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">isinstance</span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">,</span> <span id="link-168" class="py-name"><a title="zeroinstall.injector.model.Implementation" class="py-name" href="#" onclick="doclink('link-168', 'Implementation', 'Class zeroinstall.injector.model.Implementation=zeroinstall.injector.model.Implementation-class.html'); return false;">Implementation</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">549</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'/'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">550</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span> </span>
<span class="py-lineno">551</span>  <span class="py-line">                <span class="py-keyword">return</span> <span id="link-169" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-169', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-170" class="py-name"><a title="zeroinstall.zerostore.cli.stores" class="py-name" href="#" onclick="doclink('link-170', 'stores', 'Variable zeroinstall.zerostore.cli.stores=zeroinstall.zerostore.cli-module.html#stores'); return false;">stores</a></span></span><span class="py-op">.</span><span id="link-171" class="py-name"><a title="zeroinstall.zerostore.Store.lookup
zeroinstall.zerostore.Stores.lookup" class="py-name" href="#" onclick="doclink('link-171', 'lookup', 'Method zeroinstall.zerostore.Store.lookup()=zeroinstall.zerostore.Store-class.html#lookup,Method zeroinstall.zerostore.Stores.lookup()=zeroinstall.zerostore.Stores-class.html#lookup'); return false;">lookup</a></span></span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">552</span>  <span class="py-line"> </span>
<a name="Policy.get_implementation"></a><div id="Policy.get_implementation-def"><span class="py-lineno">553</span> <a class="py-toggle" href="#" id="Policy.get_implementation-toggle" onclick="toggle('Policy.get_implementation'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_implementation">get_implementation</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">interface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_implementation-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_implementation-expanded"><span class="py-lineno">554</span>  <span class="py-line">                <span class="py-docstring">"""Get the chosen implementation.</span> </span>
<span class="py-lineno">555</span>  <span class="py-line"><span class="py-docstring">                @type interface: Interface</span> </span>
<span class="py-lineno">556</span>  <span class="py-line"><span class="py-docstring">                @rtype: L{model.Implementation}</span> </span>
<span class="py-lineno">557</span>  <span class="py-line"><span class="py-docstring">                @raise SafeException: if interface has not been fetched or no implementation could be</span> </span>
<span class="py-lineno">558</span>  <span class="py-line"><span class="py-docstring">                chosen."""</span> </span>
<span class="py-lineno">559</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">isinstance</span><span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">,</span> <span id="link-172" class="py-name"><a title="zeroinstall.injector.model.Interface" class="py-name" href="#" onclick="doclink('link-172', 'Interface', 'Class zeroinstall.injector.model.Interface=zeroinstall.injector.model.Interface-class.html'); return false;">Interface</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">560</span>  <span class="py-line"> </span>
<span class="py-lineno">561</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">name</span> <span class="py-keyword">and</span> <span class="py-keyword">not</span> <span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">feeds</span><span class="py-op">:</span> </span>
<span class="py-lineno">562</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span id="link-173" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-173', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">"We don't have enough information to "</span> </span>
<span class="py-lineno">563</span>  <span class="py-line">                                            <span class="py-string">"run this program yet. "</span> </span>
<span class="py-lineno">564</span>  <span class="py-line">                                            <span class="py-string">"Need to download:\n%s"</span> <span class="py-op">%</span> <span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">565</span>  <span class="py-line">                <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno">566</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">[</span><span class="py-name">interface</span><span class="py-op">]</span> </span>
<span class="py-lineno">567</span>  <span class="py-line">                <span class="py-keyword">except</span> <span class="py-name">KeyError</span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">:</span> </span>
<span class="py-lineno">568</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">implementations</span><span class="py-op">:</span> </span>
<span class="py-lineno">569</span>  <span class="py-line">                                <span class="py-name">offline</span> <span class="py-op">=</span> <span class="py-string">""</span> </span>
<span class="py-lineno">570</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">==</span> <span id="link-174" class="py-name"><a title="zeroinstall.injector.model.network_offline" class="py-name" href="#" onclick="doclink('link-174', 'network_offline', 'Variable zeroinstall.injector.model.network_offline=zeroinstall.injector.model-module.html#network_offline'); return false;">network_offline</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">571</span>  <span class="py-line">                                        <span class="py-name">offline</span> <span class="py-op">=</span> <span class="py-string">"\nThis may be because 'Network Use' is set to Off-line."</span> </span>
<span class="py-lineno">572</span>  <span class="py-line">                                <span class="py-keyword">raise</span> <span id="link-175" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-175', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">"No usable implementation found for '%s'.%s"</span> <span class="py-op">%</span> </span>
<span class="py-lineno">573</span>  <span class="py-line">                                                <span class="py-op">(</span><span class="py-name">interface</span><span class="py-op">.</span><span class="py-name">name</span><span class="py-op">,</span> <span class="py-name">offline</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">574</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span class="py-name">ex</span> </span>
</div><span class="py-lineno">575</span>  <span class="py-line"> </span>
<a name="Policy.walk_interfaces"></a><div id="Policy.walk_interfaces-def"><span class="py-lineno">576</span> <a class="py-toggle" href="#" id="Policy.walk_interfaces-toggle" onclick="toggle('Policy.walk_interfaces'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#walk_interfaces">walk_interfaces</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.walk_interfaces-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.walk_interfaces-expanded"><span class="py-lineno">577</span>  <span class="py-line">                <span class="py-docstring">"""@deprecated: use L{implementation} instead"""</span> </span>
<span class="py-lineno">578</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">iter</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">579</span>  <span class="py-line"> </span>
<a name="Policy.get_cached"></a><div id="Policy.get_cached-def"><span class="py-lineno">580</span> <a class="py-toggle" href="#" id="Policy.get_cached-toggle" onclick="toggle('Policy.get_cached'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_cached">get_cached</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">impl</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_cached-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_cached-expanded"><span class="py-lineno">581</span>  <span class="py-line">                <span class="py-docstring">"""Check whether an implementation is available locally.</span> </span>
<span class="py-lineno">582</span>  <span class="py-line"><span class="py-docstring">                @type impl: model.Implementation</span> </span>
<span class="py-lineno">583</span>  <span class="py-line"><span class="py-docstring">                @rtype: bool</span> </span>
<span class="py-lineno">584</span>  <span class="py-line"><span class="py-docstring">                """</span> </span>
<span class="py-lineno">585</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'/'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">586</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">path</span><span class="py-op">.</span><span class="py-name">exists</span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">id</span><span class="py-op">)</span> </span>
<span class="py-lineno">587</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">588</span>  <span class="py-line">                        <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno">589</span>  <span class="py-line">                                <span class="py-name">path</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-176" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_implementation_path
zeroinstall.injector.policy.Policy.get_implementation_path" class="py-name" href="#" onclick="doclink('link-176', 'get_implementation_path', 'Method zeroinstall.injector.policy.Policy.get_implementation_path()=zeroinstall.injector.policy.Policy-class.html#get_implementation_path,Method zeroinstall.injector.policy.Policy.get_implementation_path()=zeroinstall.injector.policy.Policy-class.html#get_implementation_path'); return false;">get_implementation_path</a></span></span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">)</span> </span>
<span class="py-lineno">590</span>  <span class="py-line">                                <span class="py-keyword">assert</span> <span class="py-name">path</span> </span>
<span class="py-lineno">591</span>  <span class="py-line">                                <span class="py-keyword">return</span> <span class="py-name">True</span> </span>
<span class="py-lineno">592</span>  <span class="py-line">                        <span class="py-keyword">except</span><span class="py-op">:</span> </span>
<span class="py-lineno">593</span>  <span class="py-line">                                <span class="py-keyword">pass</span> <span class="py-comment"># OK</span> </span>
<span class="py-lineno">594</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">False</span> </span>
</div><span class="py-lineno">595</span>  <span class="py-line">         </span>
<a name="Policy.add_to_cache"></a><div id="Policy.add_to_cache-def"><span class="py-lineno">596</span> <a class="py-toggle" href="#" id="Policy.add_to_cache-toggle" onclick="toggle('Policy.add_to_cache'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#add_to_cache">add_to_cache</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">source</span><span class="py-op">,</span> <span class="py-param">data</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.add_to_cache-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.add_to_cache-expanded"><span class="py-lineno">597</span>  <span class="py-line">                <span class="py-docstring">"""Wrapper for L{iface_cache.IfaceCache.add_to_cache}."""</span> </span>
<span class="py-lineno">598</span>  <span class="py-line">                <span id="link-177" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-177', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-178" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.add_to_cache
zeroinstall.injector.policy.Policy.add_to_cache
zeroinstall.injector.policy.Policy.add_to_cache" class="py-name" href="#" onclick="doclink('link-178', 'add_to_cache', 'Method zeroinstall.injector.iface_cache.IfaceCache.add_to_cache()=zeroinstall.injector.iface_cache.IfaceCache-class.html#add_to_cache,Method zeroinstall.injector.policy.Policy.add_to_cache()=zeroinstall.injector.policy.Policy-class.html#add_to_cache,Method zeroinstall.injector.policy.Policy.add_to_cache()=zeroinstall.injector.policy.Policy-class.html#add_to_cache'); return false;">add_to_cache</a></span></span><span class="py-op">(</span><span class="py-name">source</span><span class="py-op">,</span> <span class="py-name">data</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">599</span>  <span class="py-line">         </span>
<a name="Policy.get_uncached_implementations"></a><div id="Policy.get_uncached_implementations-def"><span class="py-lineno">600</span> <a class="py-toggle" href="#" id="Policy.get_uncached_implementations-toggle" onclick="toggle('Policy.get_uncached_implementations'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_uncached_implementations">get_uncached_implementations</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_uncached_implementations-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_uncached_implementations-expanded"><span class="py-lineno">601</span>  <span class="py-line">                <span class="py-docstring">"""List all chosen implementations which aren't yet available locally.</span> </span>
<span class="py-lineno">602</span>  <span class="py-line"><span class="py-docstring">                @rtype: [model.Implementation]"""</span> </span>
<span class="py-lineno">603</span>  <span class="py-line">                <span class="py-name">uncached</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span> </span>
<span class="py-lineno">604</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">iface</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">:</span> </span>
<span class="py-lineno">605</span>  <span class="py-line">                        <span class="py-name">impl</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">[</span><span class="py-name">iface</span><span class="py-op">]</span> </span>
<span class="py-lineno">606</span>  <span class="py-line">                        <span class="py-keyword">assert</span> <span class="py-name">impl</span> </span>
<span class="py-lineno">607</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-179" class="py-name"><a title="zeroinstall.injector.policy.Policy.get_cached
zeroinstall.injector.policy.Policy.get_cached" class="py-name" href="#" onclick="doclink('link-179', 'get_cached', 'Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached,Method zeroinstall.injector.policy.Policy.get_cached()=zeroinstall.injector.policy.Policy-class.html#get_cached'); return false;">get_cached</a></span></span><span class="py-op">(</span><span class="py-name">impl</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">608</span>  <span class="py-line">                                <span class="py-name">uncached</span><span class="py-op">.</span><span class="py-name">append</span><span class="py-op">(</span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">,</span> <span class="py-name">impl</span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">609</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">uncached</span> </span>
</div><span class="py-lineno">610</span>  <span class="py-line">         </span>
<a name="Policy.refresh_all"></a><div id="Policy.refresh_all-def"><span class="py-lineno">611</span> <a class="py-toggle" href="#" id="Policy.refresh_all-toggle" onclick="toggle('Policy.refresh_all'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#refresh_all">refresh_all</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">force</span> <span class="py-op">=</span> <span class="py-name">True</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.refresh_all-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.refresh_all-expanded"><span class="py-lineno">612</span>  <span class="py-line">                <span class="py-docstring">"""Start downloading all feeds for all selected interfaces.</span> </span>
<span class="py-lineno">613</span>  <span class="py-line"><span class="py-docstring">                @param force: Whether to restart existing downloads."""</span> </span>
<span class="py-lineno">614</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">x</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">implementation</span><span class="py-op">:</span> </span>
<span class="py-lineno">615</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-180" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download
zeroinstall.injector.policy.Policy.begin_iface_download" class="py-name" href="#" onclick="doclink('link-180', 'begin_iface_download', 'Method zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download()=zeroinstall.injector.autopolicy.AutoPolicy-class.html#begin_iface_download,Method zeroinstall.injector.policy.Policy.begin_iface_download()=zeroinstall.injector.policy.Policy-class.html#begin_iface_download'); return false;">begin_iface_download</a></span></span><span class="py-op">(</span><span class="py-name">x</span><span class="py-op">,</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
<span class="py-lineno">616</span>  <span class="py-line">                        <span class="py-keyword">for</span> <span class="py-name">f</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-181" class="py-name"><a title="zeroinstall.injector.policy.Policy.usable_feeds
zeroinstall.injector.policy.Policy.usable_feeds" class="py-name" href="#" onclick="doclink('link-181', 'usable_feeds', 'Method zeroinstall.injector.policy.Policy.usable_feeds()=zeroinstall.injector.policy.Policy-class.html#usable_feeds,Method zeroinstall.injector.policy.Policy.usable_feeds()=zeroinstall.injector.policy.Policy-class.html#usable_feeds'); return false;">usable_feeds</a></span></span><span class="py-op">(</span><span class="py-name">x</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno">617</span>  <span class="py-line">                                <span class="py-name">feed_iface</span> <span class="py-op">=</span> <span id="link-182" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-182', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-183" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-183', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">f</span><span class="py-op">.</span><span class="py-name">uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">618</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span id="link-184" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download
zeroinstall.injector.policy.Policy.begin_iface_download" class="py-name" href="#" onclick="doclink('link-184', 'begin_iface_download', 'Method zeroinstall.injector.autopolicy.AutoPolicy.begin_iface_download()=zeroinstall.injector.autopolicy.AutoPolicy-class.html#begin_iface_download,Method zeroinstall.injector.policy.Policy.begin_iface_download()=zeroinstall.injector.policy.Policy-class.html#begin_iface_download'); return false;">begin_iface_download</a></span></span><span class="py-op">(</span><span class="py-name">feed_iface</span><span class="py-op">,</span> <span class="py-name">force</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">619</span>  <span class="py-line">         </span>
<a name="Policy.interface_changed"></a><div id="Policy.interface_changed-def"><span class="py-lineno">620</span> <a class="py-toggle" href="#" id="Policy.interface_changed-toggle" onclick="toggle('Policy.interface_changed'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#interface_changed">interface_changed</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">interface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.interface_changed-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.interface_changed-expanded"><span class="py-lineno">621</span>  <span class="py-line">                <span class="py-docstring">"""Callback used by L{iface_cache.IfaceCache.update_interface_from_network}."""</span> </span>
<span class="py-lineno">622</span>  <span class="py-line">                <span class="py-name">debug</span><span class="py-op">(</span><span class="py-string">"interface_changed(%s): recalculating"</span><span class="py-op">,</span> <span class="py-name">interface</span><span class="py-op">)</span> </span>
<span class="py-lineno">623</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span id="link-185" class="py-name"><a title="zeroinstall.injector.policy.Policy.recalculate
zeroinstall.injector.policy.Policy.recalculate" class="py-name" href="#" onclick="doclink('link-185', 'recalculate', 'Method zeroinstall.injector.policy.Policy.recalculate()=zeroinstall.injector.policy.Policy-class.html#recalculate,Method zeroinstall.injector.policy.Policy.recalculate()=zeroinstall.injector.policy.Policy-class.html#recalculate'); return false;">recalculate</a></span></span><span class="py-op">(</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">624</span>  <span class="py-line">         </span>
<a name="Policy.get_feed_targets"></a><div id="Policy.get_feed_targets-def"><span class="py-lineno">625</span> <a class="py-toggle" href="#" id="Policy.get_feed_targets-toggle" onclick="toggle('Policy.get_feed_targets'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_feed_targets">get_feed_targets</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">feed_iface_uri</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_feed_targets-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_feed_targets-expanded"><span class="py-lineno">626</span>  <span class="py-line">                <span class="py-docstring">"""Return a list of Interfaces for which feed_iface can be a feed.</span> </span>
<span class="py-lineno">627</span>  <span class="py-line"><span class="py-docstring">                This is used by B{0launch --feed}.</span> </span>
<span class="py-lineno">628</span>  <span class="py-line"><span class="py-docstring">                @rtype: [model.Interface]</span> </span>
<span class="py-lineno">629</span>  <span class="py-line"><span class="py-docstring">                @raise SafeException: If there are no known feeds."""</span> </span>
<span class="py-lineno">630</span>  <span class="py-line">                <span class="py-comment"># TODO: what if it isn't cached yet?</span> </span>
<span class="py-lineno">631</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">feed_iface</span> <span class="py-op">=</span> <span id="link-186" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-186', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-187" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-187', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">feed_iface_uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">632</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">feed_for</span><span class="py-op">:</span> </span>
<span class="py-lineno">633</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">name</span><span class="py-op">:</span> </span>
<span class="py-lineno">634</span>  <span class="py-line">                                <span class="py-keyword">raise</span> <span id="link-188" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-188', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">"Can't get feed targets for '%s'; failed to load interface."</span> <span class="py-op">%</span> </span>
<span class="py-lineno">635</span>  <span class="py-line">                                                <span class="py-name">feed_iface_uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">636</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span id="link-189" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-189', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">"Missing &lt;feed-for&gt; element in '%s'; "</span> </span>
<span class="py-lineno">637</span>  <span class="py-line">                                        <span class="py-string">"this interface can't be used as a feed."</span> <span class="py-op">%</span> <span class="py-name">feed_iface_uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">638</span>  <span class="py-line">                <span class="py-name">feed_targets</span> <span class="py-op">=</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">feed_for</span> </span>
<span class="py-lineno">639</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">feed_iface</span><span class="py-op">.</span><span class="py-name">name</span><span class="py-op">:</span> </span>
<span class="py-lineno">640</span>  <span class="py-line">                        <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Warning: unknown interface '%s'"</span> <span class="py-op">%</span> <span class="py-name">feed_iface_uri</span><span class="py-op">)</span> </span>
<span class="py-lineno">641</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-op">[</span><span id="link-190" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-190', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-191" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_interface
zeroinstall.injector.policy.Policy.get_interface
zeroinstall.injector.policy.Policy.get_interface" class="py-name" href="#" onclick="doclink('link-191', 'get_interface', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_interface()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface,Method zeroinstall.injector.policy.Policy.get_interface()=zeroinstall.injector.policy.Policy-class.html#get_interface'); return false;">get_interface</a></span></span><span class="py-op">(</span><span class="py-name">uri</span><span class="py-op">)</span> <span class="py-keyword">for</span> <span class="py-name">uri</span> <span class="py-keyword">in</span> <span class="py-name">feed_targets</span><span class="py-op">]</span> </span>
</div><span class="py-lineno">642</span>  <span class="py-line">         </span>
<a name="Policy.get_icon_path"></a><div id="Policy.get_icon_path-def"><span class="py-lineno">643</span> <a class="py-toggle" href="#" id="Policy.get_icon_path-toggle" onclick="toggle('Policy.get_icon_path'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_icon_path">get_icon_path</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">iface</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_icon_path-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_icon_path-expanded"><span class="py-lineno">644</span>  <span class="py-line">                <span class="py-docstring">"""Get an icon for this interface. If the icon is in the cache, use that.</span> </span>
<span class="py-lineno">645</span>  <span class="py-line"><span class="py-docstring">                If not, start a download. If we already started a download (successful or</span> </span>
<span class="py-lineno">646</span>  <span class="py-line"><span class="py-docstring">                not) do nothing.</span> </span>
<span class="py-lineno">647</span>  <span class="py-line"><span class="py-docstring">                @return: The cached icon's path, or None if no icon is currently available.</span> </span>
<span class="py-lineno">648</span>  <span class="py-line"><span class="py-docstring">                @rtype: str"""</span> </span>
<span class="py-lineno">649</span>  <span class="py-line">                <span class="py-name">path</span> <span class="py-op">=</span> <span id="link-192" class="py-name"><a title="zeroinstall.injector.iface_cache
zeroinstall.injector.iface_cache.iface_cache" class="py-name" href="#" onclick="doclink('link-192', 'iface_cache', 'Module zeroinstall.injector.iface_cache=zeroinstall.injector.iface_cache-module.html,Variable zeroinstall.injector.iface_cache.iface_cache=zeroinstall.injector.iface_cache-module.html#iface_cache'); return false;">iface_cache</a></span></span><span class="py-op">.</span><span id="link-193" class="py-name"><a title="zeroinstall.injector.iface_cache.IfaceCache.get_icon_path
zeroinstall.injector.policy.Policy.get_icon_path
zeroinstall.injector.policy.Policy.get_icon_path" class="py-name" href="#" onclick="doclink('link-193', 'get_icon_path', 'Method zeroinstall.injector.iface_cache.IfaceCache.get_icon_path()=zeroinstall.injector.iface_cache.IfaceCache-class.html#get_icon_path,Method zeroinstall.injector.policy.Policy.get_icon_path()=zeroinstall.injector.policy.Policy-class.html#get_icon_path,Method zeroinstall.injector.policy.Policy.get_icon_path()=zeroinstall.injector.policy.Policy-class.html#get_icon_path'); return false;">get_icon_path</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">650</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">path</span><span class="py-op">:</span> </span>
<span class="py-lineno">651</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">path</span> </span>
<span class="py-lineno">652</span>  <span class="py-line"> </span>
<span class="py-lineno">653</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">network_use</span> <span class="py-op">==</span> <span id="link-194" class="py-name"><a title="zeroinstall.injector.model.network_offline" class="py-name" href="#" onclick="doclink('link-194', 'network_offline', 'Variable zeroinstall.injector.model.network_offline=zeroinstall.injector.model-module.html#network_offline'); return false;">network_offline</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">654</span>  <span class="py-line">                        <span class="py-name">info</span><span class="py-op">(</span><span class="py-string">"No icon present for %s, but off-line so not downloading"</span><span class="py-op">,</span> <span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">655</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">None</span> </span>
<span class="py-lineno">656</span>  <span class="py-line"> </span>
<span class="py-lineno">657</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span id="link-195" class="py-name"><a title="zeroinstall.injector.policy.Policy.begin_icon_download
zeroinstall.injector.policy.Policy.begin_icon_download" class="py-name" href="#" onclick="doclink('link-195', 'begin_icon_download', 'Method zeroinstall.injector.policy.Policy.begin_icon_download()=zeroinstall.injector.policy.Policy-class.html#begin_icon_download,Method zeroinstall.injector.policy.Policy.begin_icon_download()=zeroinstall.injector.policy.Policy-class.html#begin_icon_download'); return false;">begin_icon_download</a></span></span><span class="py-op">(</span><span class="py-name">iface</span><span class="py-op">)</span> </span>
<span class="py-lineno">658</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">None</span> </span>
</div><span class="py-lineno">659</span>  <span class="py-line">         </span>
<a name="Policy.get_best_source"></a><div id="Policy.get_best_source-def"><span class="py-lineno">660</span> <a class="py-toggle" href="#" id="Policy.get_best_source-toggle" onclick="toggle('Policy.get_best_source'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.policy.Policy-class.html#get_best_source">get_best_source</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">impl</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Policy.get_best_source-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Policy.get_best_source-expanded"><span class="py-lineno">661</span>  <span class="py-line">                <span class="py-docstring">"""Return the best download source for this implementation.</span> </span>
<span class="py-lineno">662</span>  <span class="py-line"><span class="py-docstring">                @rtype: L{model.RetrievalMethod}"""</span> </span>
<span class="py-lineno">663</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">download_sources</span><span class="py-op">:</span> </span>
<span class="py-lineno">664</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">impl</span><span class="py-op">.</span><span class="py-name">download_sources</span><span class="py-op">[</span><span class="py-number">0</span><span class="py-op">]</span> </span>
<span class="py-lineno">665</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">None</span> </span>
</div></div><span class="py-lineno">666</span>  <span class="py-line"> </span><script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="zeroinstall-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://0install.net">Project Homepage</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">Generated by Epydoc
        3.0alpha3 on Sat Feb 10 12:48:30 2007</td>
    <td align="right" class="footer">
      <a href="http://epydoc.sourceforge.net">http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie()
  // -->
</script>
  
</body>
</html>
