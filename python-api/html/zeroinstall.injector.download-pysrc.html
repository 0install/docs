<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>zeroinstall.injector.download</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="zeroinstall-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://0install.net">Project Homepage</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="zeroinstall-module.html">Package&nbsp;zeroinstall</a> ::
        <a href="zeroinstall.injector-module.html">Package&nbsp;injector</a> ::
        Module&nbsp;download
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="zeroinstall.injector.download-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="zeroinstall.injector.download-module.html">Module zeroinstall.injector.download</a></h1>
<pre class="py-src">
<span class="py-lineno">  1</span>  <span class="py-line"><span class="py-docstring">"""</span> </span>
<span class="py-lineno">  2</span>  <span class="py-line"><span class="py-docstring">Handles URL downloads.</span> </span>
<span class="py-lineno">  3</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  4</span>  <span class="py-line"><span class="py-docstring">This is the low-level interface for downloading interfaces, implementations, icons, etc.</span> </span>
<span class="py-lineno">  5</span>  <span class="py-line"><span class="py-docstring"></span> </span>
<span class="py-lineno">  6</span>  <span class="py-line"><span class="py-docstring">@see: L{policy.Policy.begin_iface_download}</span> </span>
<span class="py-lineno">  7</span>  <span class="py-line"><span class="py-docstring">@see: L{policy.Policy.begin_archive_download}</span> </span>
<span class="py-lineno">  8</span>  <span class="py-line"><span class="py-docstring">@see: L{policy.Policy.begin_icon_download}</span> </span>
<span class="py-lineno">  9</span>  <span class="py-line"><span class="py-docstring">"""</span> </span>
<span class="py-lineno"> 10</span>  <span class="py-line"> </span>
<span class="py-lineno"> 11</span>  <span class="py-line"><span class="py-comment"># Copyright (C) 2006, Thomas Leonard</span> </span>
<span class="py-lineno"> 12</span>  <span class="py-line"><span class="py-comment"></span><span class="py-comment"># See the README file for details, or visit http://0install.net.</span> </span>
<span class="py-lineno"> 13</span>  <span class="py-line"><span class="py-comment"></span> </span>
<span class="py-lineno"> 14</span>  <span class="py-line"><span class="py-keyword">import</span> <span class="py-name">tempfile</span><span class="py-op">,</span> <span class="py-name">os</span><span class="py-op">,</span> <span class="py-name">sys</span> </span>
<span class="py-lineno"> 15</span>  <span class="py-line"><span class="py-keyword">from</span> <span id="link-0" class="py-name"><a title="zeroinstall" class="py-name" href="#" onclick="doclink('link-0', 'zeroinstall', 'Package zeroinstall=zeroinstall-module.html'); return false;">zeroinstall</a></span></span> <span class="py-keyword">import</span> <span id="link-1" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-1', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span> </span>
<span class="py-lineno"> 16</span>  <span class="py-line"><span class="py-keyword">import</span> <span class="py-name">traceback</span> </span>
<span class="py-lineno"> 17</span>  <span class="py-line"><span class="py-keyword">from</span> <span class="py-name">logging</span> <span class="py-keyword">import</span> <span class="py-name">warn</span> </span>
<span class="py-lineno"> 18</span>  <span class="py-line"> </span>
<span class="py-lineno"> 19</span>  <span class="py-line"><span id="link-2" class="py-name"><a title="zeroinstall.injector.download.download_starting" class="py-name" href="#" onclick="doclink('link-2', 'download_starting', 'Variable zeroinstall.injector.download.download_starting=zeroinstall.injector.download-module.html#download_starting'); return false;">download_starting</a></span></span> <span class="py-op">=</span> <span class="py-string">"starting"</span>  <span class="py-comment"># Waiting for UI to start it</span> </span>
<span class="py-lineno"> 20</span>  <span class="py-line"><span id="link-3" class="py-name"><a title="zeroinstall.injector.download.download_fetching" class="py-name" href="#" onclick="doclink('link-3', 'download_fetching', 'Variable zeroinstall.injector.download.download_fetching=zeroinstall.injector.download-module.html#download_fetching'); return false;">download_fetching</a></span></span> <span class="py-op">=</span> <span class="py-string">"fetching"</span>  <span class="py-comment"># In progress</span> </span>
<span class="py-lineno"> 21</span>  <span class="py-line"><span id="link-4" class="py-name"><a title="zeroinstall.injector.download.download_checking" class="py-name" href="#" onclick="doclink('link-4', 'download_checking', 'Variable zeroinstall.injector.download.download_checking=zeroinstall.injector.download-module.html#download_checking'); return false;">download_checking</a></span></span> <span class="py-op">=</span> <span class="py-string">"checking"</span>  <span class="py-comment"># Checking GPG sig (possibly interactive)</span> </span>
<span class="py-lineno"> 22</span>  <span class="py-line"><span id="link-5" class="py-name"><a title="zeroinstall.injector.download.download_complete" class="py-name" href="#" onclick="doclink('link-5', 'download_complete', 'Variable zeroinstall.injector.download.download_complete=zeroinstall.injector.download-module.html#download_complete'); return false;">download_complete</a></span></span> <span class="py-op">=</span> <span class="py-string">"complete"</span>  <span class="py-comment"># Downloaded and cached OK</span> </span>
<span class="py-lineno"> 23</span>  <span class="py-line"><span id="link-6" class="py-name"><a title="zeroinstall.injector.download.download_failed" class="py-name" href="#" onclick="doclink('link-6', 'download_failed', 'Variable zeroinstall.injector.download.download_failed=zeroinstall.injector.download-module.html#download_failed'); return false;">download_failed</a></span></span> <span class="py-op">=</span> <span class="py-string">"failed"</span> </span>
<span class="py-lineno"> 24</span>  <span class="py-line"> </span>
<a name="DownloadError"></a><div id="DownloadError-def"><span class="py-lineno"> 25</span> <a class="py-toggle" href="#" id="DownloadError-toggle" onclick="toggle('DownloadError'); return false;">-</a><span class="py-line"><span class="py-keyword">class</span> <a class="py-def-name" href="zeroinstall.injector.download.DownloadError-class.html">DownloadError</a><span class="py-op">(</span><span class="py-base-class">SafeException</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="DownloadError-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="DownloadError-expanded"><span class="py-lineno"> 26</span>  <span class="py-line">        <span class="py-keyword">pass</span> </span>
</div><span class="py-lineno"> 27</span>  <span class="py-line"> </span>
<a name="Download"></a><div id="Download-def"><span class="py-lineno"> 28</span> <a class="py-toggle" href="#" id="Download-toggle" onclick="toggle('Download'); return false;">-</a><span class="py-line"><span class="py-keyword">class</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html">Download</a><span class="py-op">(</span><span class="py-base-class">object</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="Download-expanded"><span class="py-lineno"> 29</span>  <span class="py-line">        <span id="link-7" class="py-name"><a title="zeroinstall.injector.autopolicy.AutoPolicy.__slots__
zeroinstall.injector.download.Download.__slots__
zeroinstall.injector.handler.Handler.__slots__
zeroinstall.injector.iface_cache.IfaceCache.__slots__
zeroinstall.injector.model.Dependency.__slots__
zeroinstall.injector.model.DownloadSource.__slots__
zeroinstall.injector.model.EnvironmentBinding.__slots__
zeroinstall.injector.model.Feed.__slots__
zeroinstall.injector.model.Implementation.__slots__
zeroinstall.injector.model.Interface.__slots__
zeroinstall.injector.model.Recipe.__slots__
zeroinstall.injector.model.Restriction.__slots__
zeroinstall.injector.model.RetrievalMethod.__slots__
zeroinstall.injector.model.Stability.__slots__
zeroinstall.injector.policy.Policy.__slots__
zeroinstall.injector.qdom.Element.__slots__
zeroinstall.zerostore.Stores.__slots__" class="py-name" href="#" onclick="doclink('link-7', '__slots__', 'Variable zeroinstall.injector.autopolicy.AutoPolicy.__slots__=zeroinstall.injector.autopolicy.AutoPolicy-class.html#__slots__,Variable zeroinstall.injector.download.Download.__slots__=zeroinstall.injector.download.Download-class.html#__slots__,Variable zeroinstall.injector.handler.Handler.__slots__=zeroinstall.injector.handler.Handler-class.html#__slots__,Variable zeroinstall.injector.iface_cache.IfaceCache.__slots__=zeroinstall.injector.iface_cache.IfaceCache-class.html#__slots__,Variable zeroinstall.injector.model.Dependency.__slots__=zeroinstall.injector.model.Dependency-class.html#__slots__,Variable zeroinstall.injector.model.DownloadSource.__slots__=zeroinstall.injector.model.DownloadSource-class.html#__slots__,Variable zeroinstall.injector.model.EnvironmentBinding.__slots__=zeroinstall.injector.model.EnvironmentBinding-class.html#__slots__,Variable zeroinstall.injector.model.Feed.__slots__=zeroinstall.injector.model.Feed-class.html#__slots__,Variable zeroinstall.injector.model.Implementation.__slots__=zeroinstall.injector.model.Implementation-class.html#__slots__,Variable zeroinstall.injector.model.Interface.__slots__=zeroinstall.injector.model.Interface-class.html#__slots__,Variable zeroinstall.injector.model.Recipe.__slots__=zeroinstall.injector.model.Recipe-class.html#__slots__,Variable zeroinstall.injector.model.Restriction.__slots__=zeroinstall.injector.model.Restriction-class.html#__slots__,Variable zeroinstall.injector.model.RetrievalMethod.__slots__=zeroinstall.injector.model.RetrievalMethod-class.html#__slots__,Variable zeroinstall.injector.model.Stability.__slots__=zeroinstall.injector.model.Stability-class.html#__slots__,Variable zeroinstall.injector.policy.Policy.__slots__=zeroinstall.injector.policy.Policy-class.html#__slots__,Variable zeroinstall.injector.qdom.Element.__slots__=zeroinstall.injector.qdom.Element-class.html#__slots__,Variable zeroinstall.zerostore.Stores.__slots__=zeroinstall.zerostore.Stores-class.html#__slots__'); return false;">__slots__</a></span></span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-string">'url'</span><span class="py-op">,</span> <span class="py-string">'tempfile'</span><span class="py-op">,</span> <span class="py-string">'status'</span><span class="py-op">,</span> <span class="py-string">'errors'</span><span class="py-op">,</span> <span class="py-string">'expected_size'</span><span class="py-op">,</span> </span>
<span class="py-lineno"> 30</span>  <span class="py-line">                     <span class="py-string">'expected_size'</span><span class="py-op">,</span> <span class="py-string">'child_pid'</span><span class="py-op">,</span> <span class="py-string">'child_stderr'</span><span class="py-op">,</span> <span class="py-string">'on_success'</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 31</span>  <span class="py-line"> </span>
<a name="Download.__init__"></a><div id="Download.__init__-def"><span class="py-lineno"> 32</span> <a class="py-toggle" href="#" id="Download.__init__-toggle" onclick="toggle('Download.__init__'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#__init__">__init__</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">url</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.__init__-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.__init__-expanded"><span class="py-lineno"> 33</span>  <span class="py-line">                <span class="py-docstring">"Initial status is starting."</span> </span>
<span class="py-lineno"> 34</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span> <span class="py-op">=</span> <span class="py-name">url</span> </span>
<span class="py-lineno"> 35</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span id="link-8" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-8', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">=</span> <span id="link-9" class="py-name"><a title="zeroinstall.injector.download.download_starting" class="py-name" href="#" onclick="doclink('link-9', 'download_starting', 'Variable zeroinstall.injector.download.download_starting=zeroinstall.injector.download-module.html#download_starting'); return false;">download_starting</a></span></span> </span>
<span class="py-lineno"> 36</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">on_success</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span> </span>
<span class="py-lineno"> 37</span>  <span class="py-line"> </span>
<span class="py-lineno"> 38</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span> <span class="py-op">=</span> <span class="py-name">None</span>            <span class="py-comment"># Stream for result</span> </span>
<span class="py-lineno"> 39</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">errors</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno"> 40</span>  <span class="py-line"> </span>
<span class="py-lineno"> 41</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">expected_size</span> <span class="py-op">=</span> <span class="py-name">None</span>       <span class="py-comment"># Final size (excluding skipped bytes)</span> </span>
<span class="py-lineno"> 42</span>  <span class="py-line"> </span>
<span class="py-lineno"> 43</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno"> 44</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_stderr</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
</div><span class="py-lineno"> 45</span>  <span class="py-line">         </span>
<a name="Download.start"></a><div id="Download.start-def"><span class="py-lineno"> 46</span> <a class="py-toggle" href="#" id="Download.start-toggle" onclick="toggle('Download.start'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#start">start</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.start-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.start-expanded"><span class="py-lineno"> 47</span>  <span class="py-line">                <span class="py-docstring">"""Returns stderr stream from child. Call error_stream_closed() when</span> </span>
<span class="py-lineno"> 48</span>  <span class="py-line"><span class="py-docstring">                it returns EOF."""</span> </span>
<span class="py-lineno"> 49</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-10" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-10', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">==</span> <span id="link-11" class="py-name"><a title="zeroinstall.injector.download.download_starting" class="py-name" href="#" onclick="doclink('link-11', 'download_starting', 'Variable zeroinstall.injector.download.download_starting=zeroinstall.injector.download-module.html#download_starting'); return false;">download_starting</a></span></span> </span>
<span class="py-lineno"> 50</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span> <span class="py-op">=</span> <span class="py-name">tempfile</span><span class="py-op">.</span><span class="py-name">TemporaryFile</span><span class="py-op">(</span><span class="py-name">prefix</span> <span class="py-op">=</span> <span class="py-string">'injector-dl-data-'</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 51</span>  <span class="py-line"> </span>
<span class="py-lineno"> 52</span>  <span class="py-line">                <span class="py-name">error_r</span><span class="py-op">,</span> <span class="py-name">error_w</span> <span class="py-op">=</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">pipe</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 53</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">errors</span> <span class="py-op">=</span> <span class="py-string">''</span> </span>
<span class="py-lineno"> 54</span>  <span class="py-line"> </span>
<span class="py-lineno"> 55</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> <span class="py-op">=</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">fork</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 56</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> <span class="py-op">==</span> <span class="py-number">0</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 57</span>  <span class="py-line">                        <span class="py-comment"># We are the child</span> </span>
<span class="py-lineno"> 58</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 59</span>  <span class="py-line">                                <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">close</span><span class="py-op">(</span><span class="py-name">error_r</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 60</span>  <span class="py-line">                                <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">dup2</span><span class="py-op">(</span><span class="py-name">error_w</span><span class="py-op">,</span> <span class="py-number">2</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 61</span>  <span class="py-line">                                <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">close</span><span class="py-op">(</span><span class="py-name">error_w</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 62</span>  <span class="py-line">                                <span class="py-name">self</span><span class="py-op">.</span><span id="link-12" class="py-name"><a title="zeroinstall.injector.download.Download.download_as_child" class="py-name" href="#" onclick="doclink('link-12', 'download_as_child', 'Method zeroinstall.injector.download.Download.download_as_child()=zeroinstall.injector.download.Download-class.html#download_as_child'); return false;">download_as_child</a></span></span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 63</span>  <span class="py-line">                        <span class="py-keyword">finally</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 64</span>  <span class="py-line">                                <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">_exit</span><span class="py-op">(</span><span class="py-number">1</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 65</span>  <span class="py-line"> </span>
<span class="py-lineno"> 66</span>  <span class="py-line">                <span class="py-comment"># We are the parent</span> </span>
<span class="py-lineno"> 67</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">close</span><span class="py-op">(</span><span class="py-name">error_w</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 68</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span id="link-13" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-13', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">=</span> <span id="link-14" class="py-name"><a title="zeroinstall.injector.download.download_fetching" class="py-name" href="#" onclick="doclink('link-14', 'download_fetching', 'Variable zeroinstall.injector.download.download_fetching=zeroinstall.injector.download-module.html#download_fetching'); return false;">download_fetching</a></span></span> </span>
<span class="py-lineno"> 69</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">fdopen</span><span class="py-op">(</span><span class="py-name">error_r</span><span class="py-op">,</span> <span class="py-string">'r'</span><span class="py-op">)</span> </span>
</div><span class="py-lineno"> 70</span>  <span class="py-line">         </span>
<a name="Download.download_as_child"></a><div id="Download.download_as_child-def"><span class="py-lineno"> 71</span> <a class="py-toggle" href="#" id="Download.download_as_child-toggle" onclick="toggle('Download.download_as_child'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#download_as_child">download_as_child</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.download_as_child-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.download_as_child-expanded"><span class="py-lineno"> 72</span>  <span class="py-line">                <span class="py-keyword">from</span> <span class="py-name">urllib2</span> <span class="py-keyword">import</span> <span class="py-name">urlopen</span><span class="py-op">,</span> <span class="py-name">HTTPError</span><span class="py-op">,</span> <span class="py-name">URLError</span> </span>
<span class="py-lineno"> 73</span>  <span class="py-line">                <span class="py-keyword">try</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 74</span>  <span class="py-line">                        <span class="py-keyword">import</span> <span class="py-name">shutil</span> </span>
<span class="py-lineno"> 75</span>  <span class="py-line">                        <span class="py-comment">#print "Child downloading", self.url</span> </span>
<span class="py-lineno"> 76</span>  <span class="py-line"><span class="py-comment"></span>                        <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'/'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 77</span>  <span class="py-line">                                <span class="py-keyword">if</span> <span class="py-keyword">not</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">path</span><span class="py-op">.</span><span class="py-name">isfile</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 78</span>  <span class="py-line">                                        <span class="py-keyword">print</span> <span class="py-op">&gt;&gt;</span><span class="py-name">sys</span><span class="py-op">.</span><span class="py-name">stderr</span><span class="py-op">,</span> <span class="py-string">"File '%s' does not "</span> \ </span>
<span class="py-lineno"> 79</span>  <span class="py-line">                                                <span class="py-string">"exist!"</span> <span class="py-op">%</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span> </span>
<span class="py-lineno"> 80</span>  <span class="py-line">                                        <span class="py-keyword">return</span> </span>
<span class="py-lineno"> 81</span>  <span class="py-line">                                <span class="py-name">src</span> <span class="py-op">=</span> <span class="py-name">file</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 82</span>  <span class="py-line">                        <span class="py-keyword">elif</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'http:'</span><span class="py-op">)</span> <span class="py-keyword">or</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">.</span><span class="py-name">startswith</span><span class="py-op">(</span><span class="py-string">'ftp:'</span><span class="py-op">)</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 83</span>  <span class="py-line">                                <span class="py-name">src</span> <span class="py-op">=</span> <span class="py-name">urlopen</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 84</span>  <span class="py-line">                        <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 85</span>  <span class="py-line">                                <span class="py-keyword">raise</span> <span class="py-name">Exception</span><span class="py-op">(</span><span class="py-string">'Unsupported URL protocol in: '</span> <span class="py-op">+</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 86</span>  <span class="py-line"> </span>
<span class="py-lineno"> 87</span>  <span class="py-line">                        <span class="py-name">shutil</span><span class="py-op">.</span><span class="py-name">copyfileobj</span><span class="py-op">(</span><span class="py-name">src</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 88</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span><span class="py-op">.</span><span class="py-name">flush</span><span class="py-op">(</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 89</span>  <span class="py-line">                         </span>
<span class="py-lineno"> 90</span>  <span class="py-line">                        <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">_exit</span><span class="py-op">(</span><span class="py-number">0</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 91</span>  <span class="py-line">                <span class="py-keyword">except</span> <span class="py-op">(</span><span class="py-name">HTTPError</span><span class="py-op">,</span> <span class="py-name">URLError</span><span class="py-op">)</span><span class="py-op">,</span> <span class="py-name">ex</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 92</span>  <span class="py-line">                        <span class="py-keyword">print</span> <span class="py-op">&gt;&gt;</span><span class="py-name">sys</span><span class="py-op">.</span><span class="py-name">stderr</span><span class="py-op">,</span> <span class="py-string">"Error downloading '"</span> <span class="py-op">+</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span> <span class="py-op">+</span> <span class="py-string">"': "</span> <span class="py-op">+</span> <span class="py-name">str</span><span class="py-op">(</span><span class="py-name">ex</span><span class="py-op">)</span> </span>
<span class="py-lineno"> 93</span>  <span class="py-line">                <span class="py-keyword">except</span><span class="py-op">:</span> </span>
<span class="py-lineno"> 94</span>  <span class="py-line">                        <span class="py-name">traceback</span><span class="py-op">.</span><span class="py-name">print_exc</span><span class="py-op">(</span><span class="py-op">)</span> </span>
</div><span class="py-lineno"> 95</span>  <span class="py-line">         </span>
<a name="Download.error_stream_data"></a><div id="Download.error_stream_data-def"><span class="py-lineno"> 96</span> <a class="py-toggle" href="#" id="Download.error_stream_data-toggle" onclick="toggle('Download.error_stream_data'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#error_stream_data">error_stream_data</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">,</span> <span class="py-param">data</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.error_stream_data-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.error_stream_data-expanded"><span class="py-lineno"> 97</span>  <span class="py-line">                <span class="py-docstring">"""Passed with result of os.read(error_stream, n). Can be</span> </span>
<span class="py-lineno"> 98</span>  <span class="py-line"><span class="py-docstring">                called multiple times, once for each read."""</span> </span>
<span class="py-lineno"> 99</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">data</span> </span>
<span class="py-lineno">100</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-15" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-15', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-keyword">is</span> <span id="link-16" class="py-name"><a title="zeroinstall.injector.download.download_fetching" class="py-name" href="#" onclick="doclink('link-16', 'download_fetching', 'Variable zeroinstall.injector.download.download_fetching=zeroinstall.injector.download-module.html#download_fetching'); return false;">download_fetching</a></span></span> </span>
<span class="py-lineno">101</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">errors</span> <span class="py-op">+=</span> <span class="py-name">data</span> </span>
</div><span class="py-lineno">102</span>  <span class="py-line"> </span>
<a name="Download.error_stream_closed"></a><div id="Download.error_stream_closed-def"><span class="py-lineno">103</span> <a class="py-toggle" href="#" id="Download.error_stream_closed-toggle" onclick="toggle('Download.error_stream_closed'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#error_stream_closed">error_stream_closed</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.error_stream_closed-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.error_stream_closed-expanded"><span class="py-lineno">104</span>  <span class="py-line">                <span class="py-docstring">"""Ends a download. Status changes from fetching to checking.</span> </span>
<span class="py-lineno">105</span>  <span class="py-line"><span class="py-docstring">                Calls the on_success callbacks with the rewound data stream on success,</span> </span>
<span class="py-lineno">106</span>  <span class="py-line"><span class="py-docstring">                or throws DownloadError on failure."""</span> </span>
<span class="py-lineno">107</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-17" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-17', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-keyword">is</span> <span id="link-18" class="py-name"><a title="zeroinstall.injector.download.download_fetching" class="py-name" href="#" onclick="doclink('link-18', 'download_fetching', 'Variable zeroinstall.injector.download.download_fetching=zeroinstall.injector.download-module.html#download_fetching'); return false;">download_fetching</a></span></span> </span>
<span class="py-lineno">108</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span> <span class="py-keyword">is</span> <span class="py-keyword">not</span> <span class="py-name">None</span> </span>
<span class="py-lineno">109</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> <span class="py-keyword">is</span> <span class="py-keyword">not</span> <span class="py-name">None</span> </span>
<span class="py-lineno">110</span>  <span class="py-line"> </span>
<span class="py-lineno">111</span>  <span class="py-line">                <span class="py-name">pid</span><span class="py-op">,</span> <span id="link-19" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-19', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">=</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">waitpid</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span><span class="py-op">,</span> <span class="py-number">0</span><span class="py-op">)</span> </span>
<span class="py-lineno">112</span>  <span class="py-line">                <span class="py-keyword">assert</span> <span class="py-name">pid</span> <span class="py-op">==</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> </span>
<span class="py-lineno">113</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno">114</span>  <span class="py-line"> </span>
<span class="py-lineno">115</span>  <span class="py-line">                <span class="py-name">errors</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">errors</span> </span>
<span class="py-lineno">116</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">errors</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno">117</span>  <span class="py-line"> </span>
<span class="py-lineno">118</span>  <span class="py-line">                <span class="py-keyword">if</span> <span id="link-20" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-20', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-keyword">and</span> <span class="py-keyword">not</span> <span class="py-name">errors</span><span class="py-op">:</span> </span>
<span class="py-lineno">119</span>  <span class="py-line">                        <span class="py-name">errors</span> <span class="py-op">=</span> <span class="py-string">'Download process exited with error status '</span> \ </span>
<span class="py-lineno">120</span>  <span class="py-line">                                 <span class="py-string">'code '</span> <span class="py-op">+</span> <span class="py-name">hex</span><span class="py-op">(</span><span id="link-21" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-21', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span><span class="py-op">)</span> </span>
<span class="py-lineno">121</span>  <span class="py-line"> </span>
<span class="py-lineno">122</span>  <span class="py-line">                <span class="py-name">stream</span> <span class="py-op">=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span> </span>
<span class="py-lineno">123</span>  <span class="py-line">                <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno">124</span>  <span class="py-line"> </span>
<span class="py-lineno">125</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">errors</span><span class="py-op">:</span> </span>
<span class="py-lineno">126</span>  <span class="py-line">                        <span class="py-name">error</span> <span class="py-op">=</span> <span id="link-22" class="py-name"><a title="zeroinstall.injector.download.DownloadError" class="py-name" href="#" onclick="doclink('link-22', 'DownloadError', 'Class zeroinstall.injector.download.DownloadError=zeroinstall.injector.download.DownloadError-class.html'); return false;">DownloadError</a></span></span><span class="py-op">(</span><span class="py-name">errors</span><span class="py-op">)</span> </span>
<span class="py-lineno">127</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span>    </span>
<span class="py-lineno">128</span>  <span class="py-line">                        <span class="py-name">error</span> <span class="py-op">=</span> <span class="py-name">None</span> </span>
<span class="py-lineno">129</span>  <span class="py-line"> </span>
<span class="py-lineno">130</span>  <span class="py-line">                <span class="py-comment"># Check that the download has the correct size, if we know what it should be.</span> </span>
<span class="py-lineno">131</span>  <span class="py-line"><span class="py-comment"></span>                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">expected_size</span> <span class="py-keyword">is</span> <span class="py-keyword">not</span> <span class="py-name">None</span> <span class="py-keyword">and</span> <span class="py-keyword">not</span> <span class="py-name">error</span><span class="py-op">:</span> </span>
<span class="py-lineno">132</span>  <span class="py-line">                        <span id="link-23" class="py-name"><a title="zeroinstall.injector.model.Recipe.size" class="py-name" href="#" onclick="doclink('link-23', 'size', 'Variable zeroinstall.injector.model.Recipe.size=zeroinstall.injector.model.Recipe-class.html#size'); return false;">size</a></span></span> <span class="py-op">=</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">fstat</span><span class="py-op">(</span><span class="py-name">stream</span><span class="py-op">.</span><span class="py-name">fileno</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">.</span><span class="py-name">st_size</span> </span>
<span class="py-lineno">133</span>  <span class="py-line">                        <span class="py-keyword">if</span> <span id="link-24" class="py-name"><a title="zeroinstall.injector.model.Recipe.size" class="py-name" href="#" onclick="doclink('link-24', 'size', 'Variable zeroinstall.injector.model.Recipe.size=zeroinstall.injector.model.Recipe-class.html#size'); return false;">size</a></span></span> <span class="py-op">!=</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">expected_size</span><span class="py-op">:</span> </span>
<span class="py-lineno">134</span>  <span class="py-line">                                <span class="py-name">error</span> <span class="py-op">=</span> <span id="link-25" class="py-name"><a title="zeroinstall.SafeException" class="py-name" href="#" onclick="doclink('link-25', 'SafeException', 'Class zeroinstall.SafeException=zeroinstall.SafeException-class.html'); return false;">SafeException</a></span></span><span class="py-op">(</span><span class="py-string">'Downloaded archive has incorrect size.\n'</span> </span>
<span class="py-lineno">135</span>  <span class="py-line">                                                <span class="py-string">'URL: %s\n'</span> </span>
<span class="py-lineno">136</span>  <span class="py-line">                                                <span class="py-string">'Expected: %d bytes\n'</span> </span>
<span class="py-lineno">137</span>  <span class="py-line">                                                <span class="py-string">'Received: %d bytes'</span> <span class="py-op">%</span> <span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">url</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">expected_size</span><span class="py-op">,</span> <span id="link-26" class="py-name"><a title="zeroinstall.injector.model.Recipe.size" class="py-name" href="#" onclick="doclink('link-26', 'size', 'Variable zeroinstall.injector.model.Recipe.size=zeroinstall.injector.model.Recipe-class.html#size'); return false;">size</a></span></span><span class="py-op">)</span><span class="py-op">)</span> </span>
<span class="py-lineno">138</span>  <span class="py-line"> </span>
<span class="py-lineno">139</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">error</span><span class="py-op">:</span> </span>
<span class="py-lineno">140</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-27" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-27', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">=</span> <span id="link-28" class="py-name"><a title="zeroinstall.injector.download.download_failed" class="py-name" href="#" onclick="doclink('link-28', 'download_failed', 'Variable zeroinstall.injector.download.download_failed=zeroinstall.injector.download-module.html#download_failed'); return false;">download_failed</a></span></span> </span>
<span class="py-lineno">141</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">on_success</span> <span class="py-op">=</span> <span class="py-op">[</span><span class="py-op">]</span>    <span class="py-comment"># Break GC cycles</span> </span>
<span class="py-lineno">142</span>  <span class="py-line">                        <span class="py-keyword">raise</span> <span class="py-name">error</span> </span>
<span class="py-lineno">143</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">144</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-29" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-29', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">=</span> <span id="link-30" class="py-name"><a title="zeroinstall.injector.download.download_checking" class="py-name" href="#" onclick="doclink('link-30', 'download_checking', 'Variable zeroinstall.injector.download.download_checking=zeroinstall.injector.download-module.html#download_checking'); return false;">download_checking</a></span></span> </span>
<span class="py-lineno">145</span>  <span class="py-line"> </span>
<span class="py-lineno">146</span>  <span class="py-line">                <span class="py-keyword">for</span> <span class="py-name">x</span> <span class="py-keyword">in</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">on_success</span><span class="py-op">:</span> </span>
<span class="py-lineno">147</span>  <span class="py-line">                        <span class="py-name">stream</span><span class="py-op">.</span><span class="py-name">seek</span><span class="py-op">(</span><span class="py-number">0</span><span class="py-op">)</span> </span>
<span class="py-lineno">148</span>  <span class="py-line">                        <span class="py-name">x</span><span class="py-op">(</span><span class="py-name">stream</span><span class="py-op">)</span> </span>
</div><span class="py-lineno">149</span>  <span class="py-line">         </span>
<a name="Download.abort"></a><div id="Download.abort-def"><span class="py-lineno">150</span> <a class="py-toggle" href="#" id="Download.abort-toggle" onclick="toggle('Download.abort'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#abort">abort</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.abort-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.abort-expanded"><span class="py-lineno">151</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span> <span class="py-keyword">is</span> <span class="py-keyword">not</span> <span class="py-name">None</span><span class="py-op">:</span> </span>
<span class="py-lineno">152</span>  <span class="py-line">                        <span class="py-name">warn</span><span class="py-op">(</span><span class="py-string">"Killing download process %s"</span><span class="py-op">,</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span><span class="py-op">)</span> </span>
<span class="py-lineno">153</span>  <span class="py-line">                        <span class="py-keyword">import</span> <span class="py-name">signal</span> </span>
<span class="py-lineno">154</span>  <span class="py-line">                        <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">kill</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">child_pid</span><span class="py-op">,</span> <span class="py-name">signal</span><span class="py-op">.</span><span class="py-name">SIGTERM</span><span class="py-op">)</span> </span>
<span class="py-lineno">155</span>  <span class="py-line">                <span class="py-keyword">else</span><span class="py-op">:</span> </span>
<span class="py-lineno">156</span>  <span class="py-line">                        <span class="py-name">self</span><span class="py-op">.</span><span id="link-31" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-31', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-op">=</span> <span id="link-32" class="py-name"><a title="zeroinstall.injector.download.download_failed" class="py-name" href="#" onclick="doclink('link-32', 'download_failed', 'Variable zeroinstall.injector.download.download_failed=zeroinstall.injector.download-module.html#download_failed'); return false;">download_failed</a></span></span> </span>
</div><span class="py-lineno">157</span>  <span class="py-line"> </span>
<a name="Download.get_current_fraction"></a><div id="Download.get_current_fraction-def"><span class="py-lineno">158</span> <a class="py-toggle" href="#" id="Download.get_current_fraction-toggle" onclick="toggle('Download.get_current_fraction'); return false;">-</a><span class="py-line">        <span class="py-keyword">def</span> <a class="py-def-name" href="zeroinstall.injector.download.Download-class.html#get_current_fraction">get_current_fraction</a><span class="py-op">(</span><span class="py-param">self</span><span class="py-op">)</span><span class="py-op">:</span> </span>
</div><div id="Download.get_current_fraction-collapsed" style="display:none;" pad="+++" indent="++++++++++++"></div><div id="Download.get_current_fraction-expanded"><span class="py-lineno">159</span>  <span class="py-line">                <span class="py-docstring">"""Returns the current fraction of this download that has been fetched (from 0 to 1),</span> </span>
<span class="py-lineno">160</span>  <span class="py-line"><span class="py-docstring">                or None if the total size isn't known."""</span> </span>
<span class="py-lineno">161</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span id="link-33" class="py-name"><a title="zeroinstall.injector.gpg.Signature.status" class="py-name" href="#" onclick="doclink('link-33', 'status', 'Variable zeroinstall.injector.gpg.Signature.status=zeroinstall.injector.gpg.Signature-class.html#status'); return false;">status</a></span></span> <span class="py-keyword">is</span> <span id="link-34" class="py-name"><a title="zeroinstall.injector.download.download_starting" class="py-name" href="#" onclick="doclink('link-34', 'download_starting', 'Variable zeroinstall.injector.download.download_starting=zeroinstall.injector.download-module.html#download_starting'); return false;">download_starting</a></span></span><span class="py-op">:</span> </span>
<span class="py-lineno">162</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-number">0</span> </span>
<span class="py-lineno">163</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span> <span class="py-keyword">is</span> <span class="py-name">None</span><span class="py-op">:</span> </span>
<span class="py-lineno">164</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-number">1</span> </span>
<span class="py-lineno">165</span>  <span class="py-line">                <span class="py-keyword">if</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">expected_size</span> <span class="py-keyword">is</span> <span class="py-name">None</span><span class="py-op">:</span> </span>
<span class="py-lineno">166</span>  <span class="py-line">                        <span class="py-keyword">return</span> <span class="py-name">None</span>             <span class="py-comment"># Unknown</span> </span>
<span class="py-lineno">167</span>  <span class="py-line">                <span class="py-name">current_size</span> <span class="py-op">=</span> <span class="py-name">os</span><span class="py-op">.</span><span class="py-name">fstat</span><span class="py-op">(</span><span class="py-name">self</span><span class="py-op">.</span><span class="py-name">tempfile</span><span class="py-op">.</span><span class="py-name">fileno</span><span class="py-op">(</span><span class="py-op">)</span><span class="py-op">)</span><span class="py-op">.</span><span class="py-name">st_size</span> </span>
<span class="py-lineno">168</span>  <span class="py-line">                <span class="py-keyword">return</span> <span class="py-name">float</span><span class="py-op">(</span><span class="py-name">current_size</span><span class="py-op">)</span> <span class="py-op">/</span> <span class="py-name">self</span><span class="py-op">.</span><span class="py-name">expected_size</span> </span>
</div></div><span class="py-lineno">169</span>  <span class="py-line"> </span><script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="zeroinstall-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://0install.net">Project Homepage</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">Generated by Epydoc
        3.0alpha3 on Sat Oct 21 19:18:41 2006</td>
    <td align="right" class="footer">
      <a href="http://epydoc.sourceforge.net">http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie()
  // -->
</script>
  
</body>
</html>
