<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<h2>Zero Install: Packaging Guide</h2>

<p>
This guide shows how to make software available through <a href="injector.html">Zero Install</a>.
We will start by packaging <a href='http://www.blender.org'>Blender</a>, an open source 3D modeling
and animation program.
</p>

<p>
You should already be familiar with the general operation of Zero Install. In not, start by reading
the <a href='injector-using.html'>user tutorial</a>.
</p>

<toc level='h2'/>

<h2>Tutorial</h2>

<p>
To make a program available via Zero Install you need to create an XML 'feed' file, describing which
versions are available, where they can be downloaded, and what other software they require. In this
tutorial, we'll use the graphical <b>0publish-gui</b> application to create
this file. If you don't want to use a graphical interface (for example, because
you want to publish new versions using a script) then you should read
the <a href='package-scons.html'>0publish</a> tutorial instead.
</p>

<p>
Start by getting <b>0publish-gui</b> in the usual way:
</p>

<pre>$ <b>0alias 0publish-gui http://0install.net/2007/interfaces/0publish-gui.xml</b></pre>

<p>
This program requires GTK >= 2.6 and Python >= 2.4 (these are not fetched using Zero Install at present).
</p>

<p>
Run the program, giving it the name of the feed file you want to create, which should be named after the
program:
</p>

<pre>
$ <b>0publish-gui Blender.xml</b>
</pre>

<p>
A window appears prompting you to enter some details about the program. Here, I've copied the details from
the project's <a href='http://freshmeat.net'>freshmeat.net</a> page. The
<b>Icon</b> field is optional, and we don't need to specify the feed's URL just
yet, so I've left them blank:
</p>

<p style='text-align: center'>
<img width="452" height="415" src="screens/0publish-gui/feed-info.png" alt="Creating a new feed" />
</p>

<p>
The next step it to add one or move versions of Blender to the feed, which we can do from the <b>Versions</b>
tab using the <b>Add Archive</b> button:
</p>

<p style='text-align: center'>
<img width="452" height="415" src="screens/0publish-gui/no-versions.png" alt="The Versions tab" />
</p>

<p>
Enter the URL of the archive for the new version (copy the link from the Blender site). This URL tells
other people where to get it, so it must be present. If you've already downloaded the archive then choose
it in the <b>Local copy</b> section. Otherwise, click on <b>Download</b> to download it now:
</p>

<p style='text-align: center'>
<img width="366" height="333" src="screens/0publish-gui/download-archive.png" alt="Download an archive" />
</p>

<p>
The top-level items in the archive are displayed in the <b>Extract</b> area. The reason for this is that
there are two common ways of laying out archives. Some people put the files in the archive directly, while
others create an extra top-level directory. In blender's case, the archive
contains a single top-level directory called <b>blender-2.42a-linux-glibc232-py24-i386-static</b>.
</p>

<p>
The reason this matters is because we need each version to have a similar structure. We don't want a
directory name that's going to be different each time, so we select to just extract the contents of
this directory. 0publish-gui is pretty smart about guessing whether to extract everything or just a
sub-directory, so just go with the default.
</p>

<p style='text-align: center'>
<img width="366" height="333" src="screens/0publish-gui/extract.png" alt="Choose the sub-directory" />
</p>

<p>
Now we are prompted to enter some extra information about this version. The most important field to
set is <b>Main</b>, which is the executable program inside the archive that is run when someone tries
to use your feed. The drop-down menu shows the available executables.
</p>

<p>
The <b>License</b> and <b>Released</b> fields are just for information.
<b>Released</b> is the date you added this version to the feed, so the default
of today's date is correct. The <b>OS</b> and <b>CPU</b> fields prevent people
from trying to use this version on incompatible machines. 
</p>

<p>
I've left <b>Stability</b> unset, which means that the rating will be inherited from any containing
group. Since we don't have a group, it will get the default value of <b>Testing</b>. You can also
inherit the other fields (by leaving them blank), although <b>OS</b> and
<b>CPU</b> are inherited together (you can't inherit one and not the other). Groups are useful when you
have lots of versions, so you don't have to keep specifying the same information for each one.
</p>

<p>
Finally, the shaded <b>ID</b> field display a cryptographic digest of the
archive's contents. When other people use this feed to get Blender 2.42, this
is how they know that they've downloaded exactly the same files as you have
(in case an attacker replaces the download with a modified version).
</p>

<p style='text-align: center'>
<img width="505" height="248" src="screens/0publish-gui/version-props.png" alt="Choose the main binary" />
</p>

<p>
You'll now see your new version shown in the list of versions, along with the
single archive, which says where to get it. We can try out the interface by
clicking on the <b>Save and Test</b> button:
</p>

<p style='text-align: center'>
<img width="452" height="415" src="screens/0publish-gui/one-version.png" alt="The newly added version" />
</p>

<p>
This runs <b>0launch</b> on our XML file, in the usual way. Note that version
2.42 is already cached; it was added when we clicked <b>OK</b> in the <b>Add Archive</b> box.
Click on <b>Execute</b> and check that it runs.
</p>

<p style='text-align: center'>
<img width="500" height="236" src="screens/0publish-gui/test-run.png" alt="Try it out" />
</p>

<p>
It all works perfectly, so we'll publish this feed on the web for other people to use. To do this, we need
to sign the feed so people can check that it's really from us. Go back to the
<b>Feed information</b> tab and choose your GPG key from the menu. If you don't have a key, click on the
<b>Add</b> button to create one now.
</p>

<p>
When generating a key, you'll be asked a few difficult-looking questions; it's
safest to just accept the defaults offered. Enter your name and e-mail address
when prompted, and choose a good passphrase to protect the key:
</p>

<p style='text-align: center'>
<img width="452" height="449" src="screens/0publish-gui/gpg-genkey.png" alt="Create a GPG key" />
</p>

<p>
There's one final thing left to do: we need to decide where on the web we'll publish the XML file. Enter the
URL that people will use to download your feed in the section titled <b>This feed's URL</b>. Try to
pick a location that won't change, as people will keep coming back here for updates.
</p>

<p>
Click on <b>Save</b> to save it again. This time, you'll be prompted to enter your key passphrase
(the one you chose when creating the key above):
</p>

<p style='text-align: center'>
<img width="452" height="415" src="screens/0publish-gui/sign-feed.png" alt="Sign the feed" />
</p>

<p>
The final result of all this is three files: the signed XML feed file itself, listing our single version,
your GPG public key, which lets people check the signature, and an XSLT stylesheet, in case anyone wants to
view the feed in their browser.
</p>

<p style='text-align: center'>
<img width="520" height="133" src="screens/0publish-gui/files-to-upload.png" alt="Upload the files" />
</p>

<p>
Upload all three files to your web-server. I put mine in
<a href='http://0install.net/2007/3rd-party/'>http://0install.net/2007/3rd-party</a>. Now anyone can
run Blender with the command:
</p>

<pre>$ <b>0launch http://0install.net/2007/3rd-party/Blender.xml</b></pre>

<h2>Hints</h2>

<p>
If the software depends on something else (e.g. a library) then use the <b>Add Requires</b> button to
specify this. For example, <b>0publish-gui</b> depends on <b>ROX-Lib</b>, which I specified like this:
</p>

<p style='text-align: center'>
<img width="455" height="398" src="screens/0publish-gui/requires.png" alt="Add Requires" />
</p>

<p>
When you want to add more versions, you should use the <b>Add Group</b> button to create a group.
Make sure both versions are inside the new group (use drag-and-drop to move them). Then you only need
to set the license, main, OS and CPU settings in one place. You can also share dependencies using groups.
</p>


<h2>Further reading</h2>

<dl>
 <dt><a href='package-scons.html'>Example: SCons</a></dt>
 <dd>SCons is a build tool written in Python. This tutorial shows how to use the command-line
 <b>0publish</b> command to create the XML feed, which is useful if you want to script the process.</dd>

 <dt><a href='injector-find.html'>Example: Find</a></dt>
 <dd>Find is a Python program with a dependency on a Python library. This example shows how to depend on
 other components.</dd>

 <dt><a href='package-inkscape.html'>Example: Inkscape</a></dt>
 <dd>Inkscape is distributed as a binary RPM (among other formats). This guide shows how to publish these
 RPMs so that they can be run using Zero Install (by users without root access or on Debian systems, for
 example).</dd>

 <dt><a href='package-rox.html'>Example: ROX-Filer</a></dt>
 <dd>ROX-Filer is a C program, which requires different binaries for different platforms. These binaries
 are built and published in interface files maintained by different people. Using the injector's feed
 mechanism, users only need to use the main ROX-Filer interface and will automatically get a binary for
 their platform, from the maintainer of that binary.</dd>

 <dt><a href='0publish.html'>0publish</a></dt>
 <dd>A command reference for the <b>0publish</b> command.</dd>

 <dt><a href='http://rox.sourceforge.net/desktop/node/300'>Compiling with SCons and GTK</a></dt>
 <dd>
  Now that we've made SCons available through Zero Install, we can use it in our build scripts. This
  example shows how to build a GTK application written in C using Zero Install to get the build tool
  and the header files automatically.
 </dd>
</dl>

</html>
